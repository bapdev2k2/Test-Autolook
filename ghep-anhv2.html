<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Autolook - AI Gen Image</title>
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <base target="_self">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>

    <style>
        * {
            font-family: "Montserrat", sans-serif;
            font-optical-sizing: auto;
        }

        @layer utilities {
            .bg-grid {
                background-image:
                    repeating-linear-gradient(to right, transparent 0 20px, rgb(197, 195, 195) 20px 21px),
                    repeating-linear-gradient(to bottom, transparent 0 20px, rgb(197, 195, 195) 20px 21px);
                background: linear-gradient(to_right, #d63384, #0dcaf0);
            }
        }

        .primary-key {
            background: linear-gradient(to right, #d63384, #0dcaf0);
        }

        .loading {
            display: none;
        }

        .preview-image {
            max-width: 100%;
            /* max-height: 300px; */
            margin-top: 20px;
            display: none;
        }

        .image-upload-grid {
            display: flex;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            max-width: 300px;
        }

        .image-upload-box {
            border: 2px dashed #ccc;
            border-radius: 8px;
            padding: 10px;
            text-align: center;
            cursor: pointer;
            position: relative;
            height: 96px;
        }

        .image-upload-box input {
            display: none;
        }

        .image-upload-box img {
            width: 40px;
            height: 40px;
            opacity: 0.6;
        }

        .transition-fade {
            transition: opacity 0.4s ease, transform 0.4s ease;
            opacity: 0;
            transform: translateY(10px);
        }

        .transition-fade.show {
            opacity: 1;
            transform: translateY(0);
        }

        .sidebar-active {
            background-color: #30475e;
            /* xanh nhạt */

        }

        .sidebar-active i,
        .sidebar-active span {
            color: white !important;
            /* chữ và icon màu xanh */
        }

        .fullscreen-style {
            height: 100vh !important;
            width: auto !important;
            object-fit: contain !important;
            background-color: #000;
            /* Nếu muốn nền đen khi fullscreen */
        }

        .dark body {
            background-color: #1e1e1e !important;
            color: #f5f5f5;
        }

        .dark .bg-white {
            background-color: #2c2c2c !important;
        }

        .dark .bg-\[\#F05454\] {
            background-color: #610c05 !important;
        }




        .dark .text-gray-700,
        .dark .text-gray-800 {
            color: #ddd !important;
        }

        .dark .bg-\[\#F5F5F5\] {
            background-color: #1e1e1e !important;
        }

        .dark .bg-\[\#d9d9d9\] {

            background-color: #5d5d5d !important;
        }

        .dark .sidebar-active {
            background-color: #444 !important;
        }

        .dark .group-hover\\:text-white:hover {
            color: #fff !important;
        }

        .dark textarea {
            color: #000 !important;
            /* Dark Mode cũng vẫn đen */
        }

        input#darkModeToggle:checked+label span {
            transform: translateX(180%);
        }

        .select-container {
            position: relative;
            width: 100%;

            margin: 0 auto;
        }

        .select-custom {
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            width: 200px;
            background: linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab);
            animation: gradient 3s ease infinite;
            background-size: 400% 400%;
            font-size: 15px;
            font-weight: 600;
            border-radius: 100px;
            color: white;
            cursor: pointer;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
            backdrop-filter: blur(4px);
        }

        @keyframes gradient {
            0% {
                background-position: 0% 50%;
            }

            50% {
                background-position: 100% 50%;
            }

            100% {
                background-position: 0% 50%;
            }
        }

        .select-custom:hover {


            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            border-color: rgba(255, 255, 255, 0.3);
        }

        .select-custom:focus {
            outline: none;
            box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.4);
            border-color: rgba(255, 255, 255, 0.4);
        }

        .select-icon {
            position: absolute;
            right: 1rem;
            top: 50%;
            transform: translateY(-50%);
            pointer-events: none;
            color: white;
            transition: all 0.3s ease;
        }




        .option-v1 {
            background-color: white;
            color: black;
        }



        .highlight {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 0.75rem;

            pointer-events: none;
            opacity: 0.5;
        }

        select.select-custom option {
            background: linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab);
            color: white;
            font-weight: 600;
        }

        select.select-custom option:hover {
            background: linear-gradient(-45deg, #e73c7e, #ee7752, #23d5ab, #23a6d5);
            color: #fff;
        }
    </style>
    <style>
        .gift-z {
            z-index: 9999;
        }

        .gift-glass {
            backdrop-filter: blur(4px);
        }

        .gift-badge {
            position: absolute;
            top: 65px;
            right: -30px;
        }

        .gift-pulse {
            animation: giftPulse 1.2s ease-in-out infinite;
            transform-origin: center;
        }

        @keyframes giftPulse {
            0% {
                transform: scale(1)
            }

            50% {
                transform: scale(1.06)
            }

            100% {
                transform: scale(1)
            }
        }

        #gift24h-modal button,
        #gift24h-fab {
            user-select: none;
        }

        /* Countdown cards (the “Days/Hours/Minutes/Seconds” UI) */
        .gift-count-item {
            background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%);
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, .1), 0 2px 4px -1px rgba(0, 0, 0, .06);
        }
    </style>
    <style>
        /* Áp cho toàn bộ control trong modal */
        #paramsModal {
            color-scheme: dark;
        }

        /* Nền/txt của listbox khi mở */
        #paramsModal select,
        #paramsModal option {
            background-color: #1f1f1f;
            color: #fff;
        }

        /* Khi đang focus vẫn giữ màu */
        #paramsModal select:focus option {
            background-color: #1f1f1f;
            color: #fff;
        }

        /* Ẩn viền xanh khó chịu trên Windows */
        #paramsModal select:focus {
            outline: none;
        }

        /* (tuỳ chọn) thanh cuộn của list */
        #paramsModal select::-webkit-scrollbar {
            width: 10px;
        }

        #paramsModal select::-webkit-scrollbar-thumb {
            background: #3a3a3a;
            border-radius: 6px;
        }
    </style>

</head>
<script>
    tailwind.config = {
        theme: {
            extend: {
                screens: {

                    'xs': '375px',
                    'sm': '768px',
                    'md': '1024px',
                    'lg': '1440px',
                    'xl': '1441px'
                }
            }
        }
    }
</script>
<script>
    document.addEventListener("DOMContentLoaded", () => {
        const toggle = document.getElementById("darkModeToggle");
        const html = document.documentElement;

        // Khởi tạo
        if (localStorage.getItem("theme") === "dark") {
            html.classList.add("dark");
            toggle.checked = true;
        }

        toggle.addEventListener("change", () => {
            html.classList.toggle("dark");
            localStorage.setItem("theme", html.classList.contains("dark") ? "dark" : "light");
        });
    });
</script>
<script>
    document.addEventListener("DOMContentLoaded", () => {
        const icon = document.getElementById("currentLangIcon");
        const label = document.getElementById("currentLangLabel");
        const dropdown = document.getElementById("langDropdown");
        const wrapper = document.getElementById("langDropdownWrapper");
        const currentUrl = window.location.pathname;
        const isEnglish = currentUrl.includes("-en");

        // Cập nhật giao diện ngôn ngữ hiện tại
        icon.src = isEnglish ? "./images/En.svg" : "./images/Vi.svg";
        label.textContent = isEnglish ? "English" : "Vietnamese";

        // Toggle dropdown
        window.toggleLangDropdown = () => {
            dropdown.classList.toggle("hidden");
        };

        // Thay đổi ngôn ngữ
        window.changeLang = (lang) => {
            icon.src = lang === "vi" ? "./images/Vi.svg" : "./images/En.svg";
            label.textContent = lang === "vi" ? "Vietnamese" : "English";
            dropdown.classList.add("hidden");

            if (lang === "en" && !currentUrl.includes("-en")) {
                const newUrl = currentUrl.replace(".html", "") + "-en.html";
                window.location.href = newUrl;
            } else if (lang === "vi" && currentUrl.includes("-en")) {
                const newUrl = currentUrl.replace("-en", "") || "./index.html";
                window.location.href = newUrl;
            }
        };

        // Ẩn dropdown khi click ra ngoài
        document.addEventListener("click", (e) => {
            if (!wrapper.contains(e.target)) {
                dropdown.classList.add("hidden");
            }
        });
    });
</script>

<body class="min-h-screen !bg-[#F5F5F5] bg-grid ">
    <header class="bg-white shadow-md">
        <nav style="z-index: 10;" class="container !w-full !max-w-full md:hidden mx-auto px-4 bg-white shadow-md fixed">
            <div class="flex justify-between items-center py-4">
                <!-- Logo -->
                <a href="index.php" class="text-2xl font-bold text-primary" onclickx="event.preventDefault()">
                    <span class="text-secondary whitespace-nowrap">
                        <img alt="logo"
                            src="https://w.ladicdn.com/668665e58fb7e80020232e3b/rbg/logo-1-20250711021846-tbevw.png"
                            style=" width: 60px;display: inline-block;; ">
                        <span>Autolook</span>
                    </span>
                </a>
                <!-- Mobile menu button -->
                <button class="md:hidden text-gray-700 focus:outline-none " id="mobile-menu-button">
                    <i class="fas fa-bars text-xl"></i>
                </button>
            </div>
        </nav>
        <div class="flex">
            <!-- Desltop-sidebar -->
            <nav
                class="fixed hidden md:flex w-[18rem] shadow-[5px_5px_rgba(128,128,128,0.4),10px_10px_rgba(128,128,128,0.3),15px_15px_rgba(128,128,128,0.2),20px_20px_rgba(128,128,128,0.1),25px_25px_rgba(128,128,128,0.05)] h-screen bg-[#F5F5F5] border-r border-gray-300 flex-col justify-start  overflow-y-auto z-50">
                <div class="p-4 border-b border-b-gray-300 flex justify-center items-center">
                    <a href="index.php" class="text-2xl font-bold text-primary">
                        <span class="text-secondary">
                            <img alt="logo"
                                src="https://w.ladicdn.com/668665e58fb7e80020232e3b/rbg/logo-1-20250711021846-tbevw.png"
                                style=" width: 60px; " class="mx-auto">
                            <span class="text-[30px] mt-[14px]">Autolook</span>

                        </span>
                    </a>
                </div>

                <!-- Menu chính-Desltop -->
                <div class="space-y-4 px-2 mt-4">

                    <!-- 1.tạo ảnh -->
                    <a href="tao-anh.html" class="group flex items-center space-x-3 px-4 py-3 rounded-xl border border-transparent 
          hover:bg-[#54687c]  active:bg-[#30475e] transition duration-100">
                        <i
                            class="fa-solid fa-wand-magic-sparkles opacity-[90%] text-xl text-gray-700 group-hover:text-white"></i>
                        <span class="font-medium text-gray-800 group-hover:text-white">Tạo ảnh</span>
                    </a>

                    <!-- 1.ghép ảnh -->
                    <a href="ghep-anh.html" class="group flex items-center space-x-3 px-4 py-3 rounded-xl border border-transparent 
          hover:bg-[#54687c]  active:bg-[#30475e] transition duration-100">
                        <i class="bi bi-images text-xl text-gray-700 group-hover:text-white"></i>
                        <span class="font-medium text-gray-800 group-hover:text-blue-600 group-hover:text-white">Ghép
                            ảnh</span>
                    </a>
                    <a href="upscale.html"
                        class="group flex items-center space-x-3 px-4 py-3 rounded-xl border border-transparent  hover:bg-gray-100 transition">
                        <i class="fa-solid fa-hand-sparkles opacity-[90%] text-gray-700 group-hover:text-blue-600"></i>
                        <span class="font-medium text-gray-800 group-hover:text-blue-600 group-hover:text-blue-600">Làm
                            nét</span>
                    </a>
                    <!-- 2.Lịch sử -->
                    <a href="history.html" class="group flex items-center space-x-3 px-4 py-3 rounded-xl border border-transparent 
          hover:bg-[#54687c]  active:bg-[#30475e] transition duration-100">
                        <i class="bi bi-clock-history text-gray-700 text-xl group-hover:text-white"></i>
                        <span class="font-medium text-gray-800 group-hover:text-blue-600 group-hover:text-white">Lịch
                            sử</span>
                    </a>

                    <!-- 3.Yêu thích -->
                    <a href="face.html" class="group flex items-center space-x-3 px-4 py-3 rounded-xl border border-transparent 
          hover:bg-[#54687c]  active:bg-[#30475e] transition duration-100">
                        <i class="bi bi-heart text-gray-700 text-xl group-hover:text-white"></i>
                        <span class="font-medium text-gray-800 group-hover:text-white">Khuôn mặt</span>
                    </a>

                    <!-- 5. Hướng dẫn -->
                    <a href="support.html" class="group flex items-center space-x-3 px-4 py-3 rounded-xl border border-transparent 
          hover:bg-[#54687c]  active:bg-[#30475e] transition duration-100">
                        <i class="fa-solid fa-book opacity-[90%] text-gray-700 text-xl group-hover:text-white"></i>
                        <span class="font-medium text-gray-800 group-hover:text-white">Hướng dẫn</span>
                    </a>

                    <!-- menu -->
                    <a href="contact.html" class="group flex items-center space-x-3 px-4 py-3 rounded-xl border border-transparent 
          hover:bg-[#54687c]  active:bg-[#30475e] transition duration-100">
                        <i class="bi bi-mailbox text-gray-700 text-xl group-hover:text-white"></i>
                        <span class="font-medium text-gray-800 group-hover:text-white">Liên hệ</span>
                    </a>
                    <!-- menu admin -->
                    <a href="admin-tk.php" class="group flex items-center space-x-3 px-4 py-3 rounded-xl border border-transparent 
          hover:bg-[#54687c]  active:bg-[#30475e] transition duration-100">
                        <i class="bi bi-people text-gray-700 text-xl group-hover:text-white"></i>
                        <span class="font-medium text-gray-800 group-hover:text-white">QLTK</span>
                    </a>
                    <a href="admin-key-list.php" class="group flex items-center space-x-3 px-4 py-3 rounded-xl border border-transparent 
          hover:bg-[#54687c]  active:bg-[#30475e] transition duration-100">
                        <i class="bi bi-key text-gray-700 text-xl group-hover:text-white"></i>
                        <span class="font-medium text-gray-800 group-hover:text-white">Quản lý Key</span>
                    </a>

                    <!-- 6. Chatgbt -->
                    <a href="chatgbt.php" class="group hidden flex items-center space-x-3 px-4 py-3 rounded-xl border border-transparent 
          hover:bg-[#54687c]  active:bg-[#30475e] transition duration-100">
                        <i class="bi bi-question-circle text-gray-700 text-xl group-hover:text-white"></i>
                        <span class="font-medium text-gray-800 group-hover:text-white">ChatGpt</span>
                    </a>
                </div>


                <div class="w-full flex flex-col justify-between mt-auto items-center gap-2 py-3">
                    <div class="w-full mt-auto px-4">
                        <div class="flex justify-between gap-1.5 items-center mb-2">
                            <div
                                class="popover-credit-info-v2_labelCurrentCredit___oz19 popover-credit-info-v2_labelCurrentCreditSidebar__2zC9z ">
                                <div class="bg-[#e1e1e1] px-2 border-none rounded text-gray-600 flex items-center">
                                    <!-- <i class="fa-solid fa-coins pr-1"></i> -->
                                    <svg width="18px" height="18px" viewBox="0 0 16 16" fill="none"
                                        xmlns="http://www.w3.org/2000/svg" class="opacity-[90%] relative">
                                        <rect width="16" height="16" rx="8" fill="url(#paint0_linear_1_1999)"></rect>
                                        <path
                                            d="M8.66725 4.80043C8.66725 4.30571 8.02563 4.11145 7.75121 4.52307L5.0626 8.55599C4.84108 8.88827 5.07928 9.33335 5.47863 9.33335H7.3339V11.1996C7.3339 11.6943 7.97552 11.8886 8.24994 11.4769L10.9385 7.44401C11.1601 7.11173 10.9219 6.66665 10.5225 6.66665H8.66725V4.80043Z"
                                            fill="white"></path>
                                        <defs>
                                            <linearGradient id="paint0_linear_1_1999" x1="8" y1="0" x2="8" y2="16"
                                                gradientUnits="userSpaceOnUse">
                                                <stop stop-color="#6B7280"></stop>
                                                <stop offset="1"></stop>
                                            </linearGradient>
                                        </defs>
                                    </svg>
                                    <!-- <svg xmlns="http://www.w3.org/2000/svg"  preserveAspectRatio="none" viewBox="0 0 24 24" class="opacity-[70%]"> <path d="M12,2A10,10 0 0,1 22,12A10,10 0 0,1 12,22A10,10 0 0,1 2,12A10,10 0 0,1 12,2M12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20A8,8 0 0,0 20,12A8,8 0 0,0 12,4M11,17V16H9V14H13V13H10A1,1 0 0,1 9,12V9A1,1 0 0,1 10,8H11V7H13V8H15V10H11V11H14A1,1 0 0,1 15,12V15A1,1 0 0,1 14,16H13V17H11Z"></path> </svg> -->
                                    <span class=" ml-[5px]">418</span>
                                </div>
                            </div>
                            <button type="button" class="bg-[#F05454] pl-2 pr-2 rounded hover:bg-[#30475E]">
                                <a href="./buy-credit.html">
                                    <span class="text-white">Mua Credit</span>
                                </a>
                            </button>
                        </div>
                    </div>
                    <div class="hidden w-full flex gap-2 px-4 relative border-t border-t-gray-300 pt-2">
                        <div
                            class="flex items-center px-3 py-2 rounded-md border text-xs font-semibold uppercase cursor-pointer h-8">
                            Free</div>
                    </div>
                    <div class="w-full">
                        <div class="px-4 flex flex-col gap-0.5">
                            <div class="flex justify-between text-xs font-medium text-gray-500">Không gian làm việc
                            </div>
                            <div class="relative w-full h-full" data-headlessui-state="">
                                <button
                                    class="flex items-center px-1 py-1.5 h-11 cursor-pointer w-full group hover:bg-gray-50 cursor-pointer false rounded-lg relative">
                                    <div
                                        class="shrink-0 mr-2 flex items-center justify-center w-6 h-6 bg-[#EFF4FF] rounded-md text-xs font-medium text-primary-600">
                                        A</div>
                                    <div class="grow mr-2 text-xs text-gray-700 text-left truncate">
                                        autoinbox.canvapro@gmail.com</div>
                                    <svg width="14" height="14" viewBox="0 0 14 14" fill="none"
                                        xmlns="http://www.w3.org/2000/svg"
                                        class="shrink-0 w-[14px] h-[14px] text-gray-500" data-icon="ChevronRight"
                                        aria-hidden="true">
                                        <g id="chevron-right">
                                            <path id="Icon" d="M5.25 10.5L8.75 7L5.25 3.5" stroke="currentColor"
                                                stroke-width="1.25" stroke-linecap="round" stroke-linejoin="round">
                                            </path>
                                        </g>
                                    </svg>
                                </button>
                            </div>
                        </div>

                        <div class=" relative px-4 mt-5 border-t boder-t-gray-300" x-data="{ open: false }">
                            <div class="relative inline-block text-left w-full" data-headlessui-state="">
                                <div class="w-full">
                                    <button @click="open = !open"
                                        class="flex items-center py-1 px-2 pr-2.5 pl-1 text-xs text-gray-700 mobile:px-1 bg-transparent w-full">
                                        <!-- <div class="shrink-0 flex items-center rounded-full bg-primary-600 sm:mr-2 mr-0" style="width: 32px; height: 32px; font-size: 32px; line-height: 32px;">
                                    <div class="text-center text-white scale-[0.4]" style="width: 32px; height: 32px; font-size: 32px; line-height: 32px;">H</div>
                                </div> -->
                                        <div class="w-[100%] flex flex-col text-left truncate ml-2"><span
                                                class="text-paragraph text-sm">A</span><span
                                                class="text-gray-400 text-xs">autoinbox.canvapro@gmail.com</span></div>
                                        <svg width="12" height="12" viewBox="0 0 12 12" fill="none"
                                            xmlns="http://www.w3.org/2000/svg" class="w-3 h-3 ml-2 text-gray-700"
                                            data-icon="ChevronDown" aria-hidden="true">
                                            <g id="chevron-down">
                                                <path id="Icon" d="M3 4.5L6 7.5L9 4.5" stroke="currentColor"
                                                    stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                                                </path>
                                            </g>
                                        </svg>
                                    </button>
                                </div>
                            </div>
                            <div x-show="open" @click.outside="open = false"
                                class="absolute -right-[12px] -top-[10px] mt-1.5 w-60 max-w-56 -translate-y-full divide-y divide-gray-300 origin-top-right rounded-lg bg-white border border-gray-300 shadow-lg">
                                <div class="px-1 py-1" role="none">
                                    <a
                                        class="flex items-center w-full h-9 px-3 text-gray-700 text-[14px] rounded-lg font-normal hover:bg-gray-200 cursor-pointer group justify-between">
                                        <div>Trợ giúp</div>
                                        <svg width="14" height="14" viewBox="0 0 14 14" fill="none"
                                            xmlns="http://www.w3.org/2000/svg"
                                            class="hidden w-[14px] h-[14px] text-gray-500 group-hover:flex"
                                            data-icon="ArrowUpRight" aria-hidden="true">
                                            <g id="arrow-up-right">
                                                <path id="Icon"
                                                    d="M4.08325 9.91665L9.91659 4.08331M9.91659 4.08331H4.08325M9.91659 4.08331V9.91665"
                                                    stroke="currentColor" stroke-width="1.25" stroke-linecap="round"
                                                    stroke-linejoin="round"></path>
                                            </g>
                                        </svg>
                                    </a>
                                </div>
                                <div class="p-1" id="headlessui-menu-item-:r20:" role="menuitem" tabindex="-1"
                                    data-headlessui-state="">
                                    <div
                                        class="flex items-center w-full h-9 px-3 text-gray-700 text-[14px] rounded-lg font-normal hover:bg-gray-200 cursor-pointer group justify-between">
                                        <a href="logout.php"
                                            class="flex items-center w-full h-9 px-3 text-gray-700 text-[14px] rounded-lg font-normal hover:bg-gray-200 cursor-pointer group justify-between">
                                            <div class="font-normal text-[14px] text-gray-700">Đăng xuất</div>
                                            <svg width="14" height="14" viewBox="0 0 14 14" fill="none"
                                                xmlns="http://www.w3.org/2000/svg"
                                                class="hidden w-[14px] h-[14px] text-gray-500 group-hover:flex"
                                                data-icon="ArrowUpRight" aria-hidden="true">
                                                <g id="arrow-up-right">
                                                    <path id="Icon"
                                                        d="M4.08325 9.91665L9.91659 4.08331M9.91659 4.08331H4.08325M9.91659 4.08331V9.91665"
                                                        stroke="currentColor" stroke-width="1.25" stroke-linecap="round"
                                                        stroke-linejoin="round"></path>
                                                </g>
                                            </svg>
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </nav>
            <!-- Mobile-sidebar -->
            <nav id="mobile-menu"
                class="fixed top-0 left-0 w-64 h-full bg-white border-r border-gray-300 transform -translate-x-full transition-transform duration-300 md:relative md:translate-x-0  md:transform-none hidden  z-50 overflow-auto">
                <div class="p-4 border-b border-b-gray-300">
                    <h1 class="text-2xl font-bold text-center text-gray-800 "><img alt="logo"
                            src="https://w.ladicdn.com/668665e58fb7e80020232e3b/rbg/logo-1-20250711021846-tbevw.png"
                            style=" width: 60px;display: inline-block;; "> Autolook</h1>
                </div>

                <!-- Menu chính -->
                <div class="space-y-4 px-2 mt-4">

                    <!-- 1.tạo ảnh -->
                    <a href="tao-anh.html"
                        class="group flex items-center space-x-3 px-4 py-3 rounded-xl border border-transparent  hover:bg-gray-100 transition">
                        <i
                            class="fa-solid fa-wand-magic-sparkles opacity-[90%] text-gray-700 group-hover:text-blue-600"></i>
                        <span class="font-medium text-gray-800 group-hover:text-blue-600 group-hover:text-blue-600">Tạo
                            ảnh</span>
                    </a>
                    <!--2.ghép ảnh-->
                    <a href="ghep-anh.html"
                        class="group flex items-center space-x-3 px-4 py-3 rounded-xl border border-transparent  hover:bg-gray-100 transition">
                        <i class="bi bi-images opacity-[90%] text-gray-700 group-hover:text-blue-600"></i>
                        <span class="font-medium text-gray-800 group-hover:text-blue-600 group-hover:text-blue-600">Ghép
                            ảnh</span>
                    </a>
                    <a href="upscale.html"
                        class="group flex items-center space-x-3 px-4 py-3 rounded-xl border border-transparent  hover:bg-gray-100 transition">
                        <i class="fa-solid fa-hand-sparkles opacity-[90%] text-gray-700 group-hover:text-blue-600"></i>
                        <span class="font-medium text-gray-800 group-hover:text-blue-600 group-hover:text-blue-600">Làm
                            nét</span>
                    </a>
                    <!-- 2.Lịch sử -->
                    <a href="history.html"
                        class="group flex items-center space-x-3 px-4 py-3 rounded-xl border border-transparent  hover:bg-gray-100 transition">
                        <i class="bi bi-clock-history text-gray-700 text-xl group-hover:text-blue-600"></i>
                        <span class="font-medium text-gray-800 group-hover:text-blue-600 group-hover:text-blue-600">Lịch
                            sử</span>
                    </a>

                    <!-- 3.Yêu thích -->
                    <a href="face.html"
                        class="group flex items-center space-x-3 px-4 py-3 rounded-xl border border-transparent  hover:bg-gray-100 transition">
                        <i class="bi bi-heart text-gray-700 text-xl group-hover:text-blue-600"></i>
                        <span class="font-medium text-gray-800 group-hover:text-blue-600">Khuôn mặt</span>
                    </a>

                    <!-- 4. Mẹo -->
                    <a href="#"
                        class="group flex items-center space-x-3 px-4 py-3 rounded-xl border border-transparent  hover:bg-gray-100 transition">
                        <i class="bi bi-lightbulb text-gray-700 text-xl group-hover:text-blue-600"></i>
                        <span class="font-medium text-gray-800 group-hover:text-blue-600">Mẹo</span>
                    </a>

                    <!-- 5. Hướng dẫn -->
                    <a href="support.html"
                        class="group flex items-center space-x-3 px-4 py-3 rounded-xl border border-transparent hover:bg-gray-100 transition">
                        <i class="fa-solid fa-book opacity-[90%] text-gray-700 text-xl group-hover:text-blue-600"></i>
                        <span class="font-medium text-gray-800 group-hover:text-blue-600">Hướng dẫn</span>
                    </a>
                    <!-- menu -->
                    <a href="contact.html"
                        class="group flex items-center space-x-3 px-4 py-3 rounded-xl border border-transparent hover:bg-gray-100 transition">
                        <i class="bi bi-question-circle text-gray-700 text-xl group-hover:text-blue-600"></i>
                        <span class="font-medium text-gray-800 group-hover:text-blue-600">Liên hệ</span>
                    </a>

                    <!-- 6. Chatgbt -->
                    <a href="chatgbt.php"
                        class="hidden group flex items-center space-x-3 px-4 py-3 rounded-xl border border-transparent hover:bg-gray-100 transition">
                        <i class="bi bi-question-circle text-gray-700 text-xl group-hover:text-blue-600"></i>
                        <span class="font-medium text-gray-800 group-hover:text-blue-600">ChatGpt</span>
                    </a>
                </div>

                <!--  Phần quản lý tài khoản -->
                <div class="w-full flex flex-col justify-between mt-auto items-center gap-2 py-3">
                    <div class="w-full mt-auto px-4">
                        <div class="flex gap-1.5 items-center mb-2">
                            <div
                                class=" popover-credit-info-v2_labelCurrentCredit___oz19 popover-credit-info-v2_labelCurrentCreditSidebar__2zC9z ">
                                <div class="bg-[#e1e1e1] px-2 border-none rounded text-gray-600 flex items-center">
                                    <!-- <i class="fa-solid fa-coins pr-1"></i> -->
                                    <svg width="18px" height="18px" viewBox="0 0 16 16" fill="none"
                                        xmlns="http://www.w3.org/2000/svg" class="opacity-[90%] relative">
                                        <rect width="16" height="16" rx="8" fill="url(#paint0_linear_1_1999)"></rect>
                                        <path
                                            d="M8.66725 4.80043C8.66725 4.30571 8.02563 4.11145 7.75121 4.52307L5.0626 8.55599C4.84108 8.88827 5.07928 9.33335 5.47863 9.33335H7.3339V11.1996C7.3339 11.6943 7.97552 11.8886 8.24994 11.4769L10.9385 7.44401C11.1601 7.11173 10.9219 6.66665 10.5225 6.66665H8.66725V4.80043Z"
                                            fill="white"></path>
                                        <defs>
                                            <linearGradient id="paint0_linear_1_1999" x1="8" y1="0" x2="8" y2="16"
                                                gradientUnits="userSpaceOnUse">
                                                <stop stop-color="#6B7280"></stop>
                                                <stop offset="1"></stop>
                                            </linearGradient>
                                        </defs>
                                    </svg>
                                    <!-- <svg xmlns="http://www.w3.org/2000/svg"  preserveAspectRatio="none" viewBox="0 0 24 24" class="opacity-[70%]"> <path d="M12,2A10,10 0 0,1 22,12A10,10 0 0,1 12,22A10,10 0 0,1 2,12A10,10 0 0,1 12,2M12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20A8,8 0 0,0 20,12A8,8 0 0,0 12,4M11,17V16H9V14H13V13H10A1,1 0 0,1 9,12V9A1,1 0 0,1 10,8H11V7H13V8H15V10H11V11H14A1,1 0 0,1 15,12V15A1,1 0 0,1 14,16H13V17H11Z"></path> </svg> -->
                                    <span class=" ml-[5px]">418</span>
                                </div>
                            </div>
                            <button type="button" class="bg-[#F05454] pl-2 pr-2 rounded hover:bg-blue-700">
                                <a href="./buy-credit.html">
                                    <span class="text-white">Mua Credit</span>
                                </a>
                            </button>
                        </div>
                    </div>
                    <div class="w-full flex gap-2 px-4 relative border-t border-t-gray-300 pt-2">
                        <div
                            class="flex items-center px-3 py-2 rounded-md border text-xs font-semibold uppercase cursor-pointer h-8">
                            Free</div>
                    </div>
                    <div class="w-full">
                        <div class="px-4 flex flex-col gap-0.5">
                            <div class="flex justify-between text-xs font-medium text-gray-500">Không gian làm việc
                            </div>
                            <div class="relative w-full h-full" data-headlessui-state="">
                                <button
                                    class="flex items-center px-1 py-1.5 h-11 cursor-pointer w-full group hover:bg-gray-50 cursor-pointer false rounded-lg relative">
                                    <div
                                        class="shrink-0 mr-2 flex items-center justify-center w-6 h-6 bg-[#EFF4FF] rounded-md text-xs font-medium text-primary-600">
                                        L</div>
                                    <div class="grow mr-2 text-xs text-gray-700 text-left truncate">
                                        autoinbox.canvapro@gmail.com</div>
                                    <svg width="14" height="14" viewBox="0 0 14 14" fill="none"
                                        xmlns="http://www.w3.org/2000/svg"
                                        class="shrink-0 w-[14px] h-[14px] text-gray-500" data-icon="ChevronRight"
                                        aria-hidden="true">
                                        <g id="chevron-right">
                                            <path id="Icon" d="M5.25 10.5L8.75 7L5.25 3.5" stroke="currentColor"
                                                stroke-width="1.25" stroke-linecap="round" stroke-linejoin="round">
                                            </path>
                                        </g>
                                    </svg>
                                </button>
                            </div>
                        </div>

                        <div class=" relative px-4 mt-5 border-t boder-t-gray-300" x-data="{ open: false }">
                            <div class="relative inline-block text-left w-full" data-headlessui-state="">
                                <div class="w-full">
                                    <button @click="open = !open"
                                        class="flex items-center py-1 px-2 pr-2.5 pl-1 text-xs text-gray-700 mobile:px-1 bg-transparent w-full">
                                        <!-- <div class="shrink-0 flex items-center rounded-full bg-primary-600 sm:mr-2 mr-0" style="width: 32px; height: 32px; font-size: 32px; line-height: 32px;">
                                    <div class="text-center text-white scale-[0.4]" style="width: 32px; height: 32px; font-size: 32px; line-height: 32px;">H</div>
                                </div> -->
                                        <div class="w-[100%] flex flex-col text-left truncate ml-2"><span
                                                class="text-paragraph text-sm">A</span><span
                                                class="text-gray-400 text-xs">autoinbox.canvapro@gmail.com</span></div>
                                        <svg width="12" height="12" viewBox="0 0 12 12" fill="none"
                                            xmlns="http://www.w3.org/2000/svg" class="w-3 h-3 ml-2 text-gray-700"
                                            data-icon="ChevronDown" aria-hidden="true">
                                            <g id="chevron-down">
                                                <path id="Icon" d="M3 4.5L6 7.5L9 4.5" stroke="currentColor"
                                                    stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                                                </path>
                                            </g>
                                        </svg>
                                    </button>
                                </div>
                            </div>
                            <div x-show="open" @click.outside="open = false"
                                class="absolute -right-[12px] -top-[10px] mt-1.5 w-60 max-w-56 -translate-y-full divide-y divide-gray-300 origin-top-right rounded-lg bg-white border border-gray-300 shadow-lg">
                                <div class="px-1 py-1" role="none">
                                    <a
                                        class="flex items-center w-full h-9 px-3 text-gray-700 text-[14px] rounded-lg font-normal hover:bg-gray-200 cursor-pointer group justify-between">
                                        <div>Trợ giúp</div>
                                        <svg width="14" height="14" viewBox="0 0 14 14" fill="none"
                                            xmlns="http://www.w3.org/2000/svg"
                                            class="hidden w-[14px] h-[14px] text-gray-500 group-hover:flex"
                                            data-icon="ArrowUpRight" aria-hidden="true">
                                            <g id="arrow-up-right">
                                                <path id="Icon"
                                                    d="M4.08325 9.91665L9.91659 4.08331M9.91659 4.08331H4.08325M9.91659 4.08331V9.91665"
                                                    stroke="currentColor" stroke-width="1.25" stroke-linecap="round"
                                                    stroke-linejoin="round"></path>
                                            </g>
                                        </svg>
                                    </a>
                                </div>
                                <div class="p-1" id="headlessui-menu-item-:r20:" role="menuitem" tabindex="-1"
                                    data-headlessui-state="">
                                    <div
                                        class="flex items-center w-full h-9 px-3 text-gray-700 text-[14px] rounded-lg font-normal hover:bg-gray-200 cursor-pointer group justify-between">
                                        <a href="logout.php"
                                            class="flex items-center w-full h-9 px-3 text-gray-700 text-[14px] rounded-lg font-normal hover:bg-gray-200 cursor-pointer group justify-between">
                                            <div class="font-normal text-[14px] text-gray-700">Đăng xuất</div>
                                            <svg width="14" height="14" viewBox="0 0 14 14" fill="none"
                                                xmlns="http://www.w3.org/2000/svg"
                                                class="hidden w-[14px] h-[14px] text-gray-500 group-hover:flex"
                                                data-icon="ArrowUpRight" aria-hidden="true">
                                                <g id="arrow-up-right">
                                                    <path id="Icon"
                                                        d="M4.08325 9.91665L9.91659 4.08331M9.91659 4.08331H4.08325M9.91659 4.08331V9.91665"
                                                        stroke="currentColor" stroke-width="1.25" stroke-linecap="round"
                                                        stroke-linejoin="round"></path>
                                                </g>
                                            </svg>
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </nav>
    </header>

    <main
        class="container mx-auto px-4 py-8 md:pl-64 md:mt-0 sm:mt-[80px] xs:mt-20 md:!max-w-[888px] lg:!max-w-[1080px] xl:!max-w-[1440px]">

        <!-- <main class="container mx-auto w-full md:ml-64 px-4 py-8  inline-flex md:pt-24 md:pl-4 md:pr-4"> -->
        <div class="absolute md:top-8 md:right-7 flex items-center gap-2 xs:right-[45px] xs:top-3">

            <div style="z-index: 49;"
                class=" flex flex-col justify-center items-center gap-3 xs:fixed lg:static md:top-8 md:right-[-2rem] lg:right-7 xs:top-3 xs:right-14 sm:right-20 top-[1rem]">
                <!-- Toggle Switch Dark/Light -->
                <div class="flex items-center gap-2">
                    <b class="sm:block md:hidden lg:block xs:hidden">Dark</b>
                    <input type="checkbox" id="darkModeToggle" class="sr-only">
                    <label for="darkModeToggle"
                        class="flex items-center cursor-pointer relative w-16 h-7 rounded-full bg-[#30475e] dark:bg-gray-700 transition">
                        <span
                            class="absolute left-1 top-1 w-5 h-5 z-10 rounded-full bg-white shadow-md transform transition peer-checked:translate-x-8"
                            id="toggleBall"></span>
                        <i
                            class="fas fa-moon text-gray-400 sm:text-xl xs:text-base absolute left-2 top-0.4 pointer-events-none z-9 dark:text-gray-200"></i>
                        <i
                            class="fas fa-sun text-yellow-400 sm:text-base xs:text-sm absolute sm:right-[6px] xs:right-2 xs:top-1 sm:top-0.5 pointer-events-none z-9"></i>
                    </label>
                    <b class="sm:block md:hidden lg:block xs:hidden">Light</b>
                </div>
                <div class="relative flex justify-center inline-block text-left md:w-[150px] xs:w-[100px]"
                    id="langDropdownWrapper">
                    <button onclick="toggleLangDropdown()"
                        class="inline-flex justify-center items-center lg:w-full md:w-[64px] px-4 md:py-2 xs:py-1 bg-white rounded-xl text-sm xs:border md:border-none xs:shadow-none md:shadow-[0px_14px_28px_rgba(0,0,0,0.25),_0px_10px_10px_rgba(0,0,0,0.22)]">
                        <img id="currentLangIcon" src="./images/Vi.svg" alt="" class="w-5 h-5 mr-2">
                        <span id="currentLangLabel" class="lg:block xs:hidden">Vietnamese</span>
                        <span id="currentLangLabel" class="lg:hidden xs:block">VN</span>
                        <svg class="ml-2 w-4 h-4" fill="none" stroke="currentColor" stroke-width="2"
                            viewBox="0 0 24 24">
                            <path d="M19 9l-7 7-7-7" />
                        </svg>
                    </button>

                    <div id="langDropdown"
                        class="hidden absolute z-10 mt-1 w-full bg-white border border-gray-300 rounded shadow">
                        <div onclick="changeLang('vi')"
                            class="flex items-center px-4 py-2 cursor-pointer hover:bg-gray-100">
                            <img src="./images/Vi.svg" class="w-5 h-5 mr-2">
                            <span class="md:block xs:hidden">Vietnamese</span>
                            <span class="md:hidden xs:block">VN</span>
                        </div>
                        <div onclick="changeLang('en')"
                            class="flex items-center px-4 py-2 cursor-pointer hover:bg-gray-100">
                            <img src="./images/En.svg" class="w-5 h-5 mr-2">
                            <span class="md:block xs:hidden">English</span>
                            <span class="md:hidden xs:block">EN</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- CHẾ ĐỘ (custom dropdown, không dùng <select>) -->
        <div class="relative">
            <div class="absolute xs:left-[5.7rem] w-fit top-16 px-4 mt-4 z-[50]">
                <div class="flex justify-center items-center">

                    <label class="block text-center font-medium mb-1 bg-white w-fit px-2 rounded-full font-semibold">Chế
                        độ</label>
                </div>

                <!-- Nút hiển thị, dùng đúng gradient 'select-custom' sẵn có -->
                <button id="modeBtn"
                    class="select-custom w-[130px] h-10 px-4 rounded-full flex items-center justify-between">
                    <span id="modeLabel" class="font-bold">Chọn model</span>
                    <i class="fa-solid fa-chevron-down ml-3 text-white/90"></i>
                </button>

                <!-- Menu dropdown có nền gradient -->
                <div id="modeMenu" class="hidden absolute mt-2 w-[220px]">
                    <div class="p-[3px] rounded-2xl
         bg-[linear-gradient(-45deg,#ee7752,#e73c7e,#23a6d5,#23d5ab)]
         animate-[gradient_3s_ease_infinite] [background-size:400%_400%]">
                        <div class="rounded-xl bg-white/10 backdrop-blur">
                            <button type="button" data-target="ghep-anhv2.html"
                                class="w-full text-left px-4 py-2.5 font-semibold text-white hover:bg-white/10 rounded-t-xl">
                                Thủ công
                            </button>
                            <button type="button" data-target="ghep-anh.html"
                                class="w-full text-left px-4 py-2.5 font-semibold text-white hover:bg-white/10 rounded-b-xl">
                                Tự động
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="relative w-full h-16 mb-6 flex justify-center items-center">
                <!-- Nền chính -->
                <div
                    class="absolute inset-0 rounded-full bg-[linear-gradient(-225deg,#FFE29F_0%,#FFA99F_48%,#FF719A_100%)] shadow-[0px_10px_20px_rgba(0,0,0,0.25)]">
                </div>

                <!-- Viền sáng xoay -->
                <div
                    class="absolute inset-0 rounded-full p-[3px] bg-[conic-gradient(var(--angle),#ff9a9e,#fad0c4,#fbc2eb,#a6c1ee,#ff9a9e)] animate-spin-slow">
                    <div class="w-full h-full rounded-full bg-[#fff5] backdrop-blur-sm"></div>
                </div>

                <!-- Nút bấm -->
                <button id="gift24h-fab" class="relative z-10 flex items-center gap-2 px-8 py-2 rounded-full 
           bg-gradient-to-r from-pink-500 to-red-400 text-white font-bold 
           text-lg uppercase shadow-lg hover:scale-105 active:scale-95 transition">
                    <i class="fa-solid fa-gift animate-bounce"></i>
                    <span>SALE 24H</span>
                </button>
            </div>
        </div>
        <!-- <div
            class="sm:text-center xs:text-start flex flex-col items-center justify-center w-full xs:text-[12px] sm:text-[14px] bg-[#F5F5F5] shadow-[0px_14px_28px_rgba(0,0,0,0.25),_0px_10px_10px_rgba(0,0,0,0.22)] rounded-2xl p-4 font-semibold">

            <span>
                - Trình ghép ảnh cho phép bạn ghép trang phục và phụ kiện lên một bức ảnh người mẫu có sẵn ( Tỉ lệ ghép
                ra
                ảnh chuẩn 80-90% ).
            </span>
            <span>- A.I sẽ tham
                chiếu bức ảnh gốc, chỉ thay thế trang phục và phụ kiện.</span>
            <span>
                - Giữ nguyên các chi tiết còn lại trong bức ảnh ( người mẫu, Background ).
            </span>
            <span>- Với những sản phẩm khó không ghép được ảnh, bạn hãy sử dụng trình tạo ảnh
                để tạo ra người mẫu mặc sản phẩm.</span>
            <div class="flex">
                <span>
                    Click vào đây:
                </span>
                <a href="https://hd.autolook.vn/meo-huong-dan-autolook-full" class="ml-1 underline">
                    Truy cập phần hướng dẫn để hiểu rõ toàn bộ tính năng của AutoLook.
                </a>
            </div>

        </div> -->
        <div class=" md:grid mt-[100px]">
            <div class="flex flex-col">
                <div
                    class="xs:grid bg-[#F5F5F5]  md:rounded-3xl shadow-[0px_14px_28px_rgba(0,0,0,0.25),_0px_10px_10px_rgba(0,0,0,0.22)] p-6 sm:max-w-full max-w-mdx xs:max-w-[375px] xs:rounded-2xl break-after-column">
                    <!-- <h1 class="text-2xl font-bold text-gray-800 mb-6 bg-[#30475E] text-white p-2 text-center rounded-full">Chọn ảnh đầu vào</h1> -->

                    <div>
                        <h1
                            class="text-2xl font-bold text-gray-800 mb-6 bg-[#30475E] text-white p-2 text-center rounded-full">
                            Trình ghép ảnh thủ công</h1>

                    </div>
                    <div class="flex md:flex-row xs: flex-col gap-10 xs:mx-0 md:mx-14">
                        <div class="w-full">
                            <h1
                                class="text-lg font-bold text-gray-800 mb-4 bg-gradient-to-r from-pink-500 to-red-400 text-white p-1 text-center rounded-full">
                                Ảnh người mẫu</h1>
                            <label for="imageInput"
                                class="relative w-full h-[55vh] border-2 border-dashed border-gray-300 rounded-xl cursor-pointer flex items-center justify-center overflow-hidden group">
                                <!-- Ảnh xem trước -->
                                <img id="previewImage"
                                    class="absolute top-0 left-0 w-full h-full object-contain hidden z-10">

                                <!-- Icon + Text nếu chưa có ảnh -->
                                <div id="placeholderContent"
                                    class="text-center text-gray-500 flex flex-col items-center justify-center z-0 group-hover:text-gray-700">
                                    <i class="fas fa-cloud-upload-alt text-4xl mb-2"></i>
                                    <span>Nhấn hoặc kéo ảnh vào đây</span>
                                </div>

                                <!-- Input ẩn -->
                                <input type="file" id="imageInput" accept="image/*"
                                    class="absolute inset-0 opacity-0 cursor-pointer z-20">
                            </label>
                        </div>

                        <div class="w-full">
                            <h1
                                class="text-lg font-bold text-gray-800 mb-4 bg-gradient-to-r from-pink-500 to-red-400 text-white p-1 text-center rounded-full">
                                Ảnh sản phẩm</h1>
                            <label for="imageInput"
                                class="relative w-full h-[55vh] border-2 border-dashed border-gray-300 rounded-xl cursor-pointer flex items-center justify-center overflow-hidden group">
                                <!-- Ảnh xem trước -->
                                <img id="previewImage"
                                    class="absolute top-0 left-0 w-full h-full object-contain hidden z-10">

                                <!-- Icon + Text nếu chưa có ảnh -->
                                <div id="placeholderContent"
                                    class="text-center text-gray-500 flex flex-col items-center justify-center z-0 group-hover:text-gray-700">
                                    <i class="fas fa-cloud-upload-alt text-4xl mb-2"></i>
                                    <span>Nhấn hoặc kéo ảnh vào đây</span>
                                </div>

                                <!-- Input ẩn -->
                                <input type="file" id="imageInput" accept="image/*"
                                    class="absolute inset-0 opacity-0 cursor-pointer z-20">
                            </label>
                        </div>
                    </div>
                    <div class="flex md:flex-row xs:flex-col justify-center xs:mt-[20px] md:mt-0">
                        <div class="xs:block md:hidden mx-auto">
                            <div class="">
                                <button type="submit" id="submitBtn" class="bg-[#F05454] transition-all duration-300 ease-in-out text-white sm:w-[10rem] xs:w-[150px] xs:h-[36px] flex items-center justify-around py-2 px-4
                                            rounded-full shadow-sm text-sm font-bold text-white
                                            focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                                    <span>Tô vùng chọn</span>
                                </button>
                            </div>
                        </div>
                        <div class="flex justify-center mt-5 gap-5">
                            <div class="xs:hidden md:block">
                                <div class="">
                                    <button type="submit" id="submitBtn" class="bg-[#F05454] transition-all duration-300 ease-in-out text-white sm:w-[10rem] xs:w-[150px] xs:h-[36px] flex items-center justify-around py-2 px-4
                                            rounded-full shadow-sm text-sm font-bold text-white
                                            focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                                        <span>Tô vùng chọn</span>
                                    </button>
                                </div>
                            </div>
                            <div>
                                <div class="">
                                    <button type="submit" id="paramsBtn" class="bg-[#F05454] transition-all duration-300 ease-in-out text-white sm:w-[10rem] xs:w-[130px] xs:h-[36px] flex items-center justify-around py-2 px-4
                                            rounded-full shadow-sm text-sm font-bold text-white
                                            focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                                        <span>Thông số</span>
                                    </button>
                                </div>
                            </div>
                            <div class="">
                                <button type="submit" id="submitBtn" class="bg-[#F05454] transition-all duration-300 ease-in-out text-white sm:w-[10rem] xs:w-[130px] xs:h-[36px] flex items-center justify-around py-2 px-4
                                            rounded-full shadow-sm text-sm font-medium text-white
                                            focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                                    <div class="flex"><span class="font-bold">1</span>&nbsp;<svg width="18px"
                                            height="18px" viewBox="0 0 16 16" fill="none"
                                            xmlns="http://www.w3.org/2000/svg" class="opacity-[90%] relative">
                                            <rect width="16" height="16" rx="8" fill="url(#paint0_linear_1_1999)">
                                            </rect>
                                            <path
                                                d="M8.66725 4.80043C8.66725 4.30571 8.02563 4.11145 7.75121 4.52307L5.0626 8.55599C4.84108 8.88827 5.07928 9.33335 5.47863 9.33335H7.3339V11.1996C7.3339 11.6943 7.97552 11.8886 8.24994 11.4769L10.9385 7.44401C11.1601 7.11173 10.9219 6.66665 10.5225 6.66665H8.66725V4.80043Z"
                                                fill="white"></path>
                                            <defs>
                                                <linearGradient id="paint0_linear_1_1999" x1="8" y1="0" x2="8" y2="16"
                                                    gradientUnits="userSpaceOnUse">
                                                    <stop stop-color="#6B7280"></stop>
                                                    <stop offset="1"></stop>
                                                </linearGradient>
                                            </defs>
                                        </svg>&nbsp;</div><span>Thực hiện</span>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- 4. Loading icon -->
                    <div id="loading" class="loading text-center py-4">
                        <i class="fas fa-spinner fa-spin text-blue-500 text-2xl"></i>
                        <p class="mt-2 text-gray-600">Đang xử lý...</p>
                    </div>

                </div>

            </div>
            <div class="flex gap-3 mt-[20px]">
                <!-- <div
                    class="hidden sm:block bg-[#F5F5F5] rounded-lg shadow-[0px_14px_28px_rgba(0,0,0,0.25),_0px_10px_10px_rgba(0,0,0,0.22)] p-6 w-full h-full max-w-mdx aspect-square text-center break-after-column">
                    <h1
                        class="text-2xl font-bold text-gray-800 mb-6 bg-[#30475E] text-white p-2 text-center rounded-full">
                        Hình ảnh đầu vào</h1>
                    <div id="imagePreview-in" class="preview-image-in" style=" text-align: center; ">
                        <img id="previewImage" src="" alt="Hình ảnh xem trước"
                            style="max-width: 100%;display: inline-block; display: none;">
                    </div>
                </div> -->

                <div
                    class="bg-[#F5F5F5] md:rounded-3xl shadow-[0px_14px_28px_rgba(0,0,0,0.25),_0px_10px_10px_rgba(0,0,0,0.22)] p-6 sm:w-full xs:w-[375px] xs:rounded-2xl max-w-mdx text-center break-after-column">
                    <h1
                        class="text-2xl font-bold text-gray-800 mb-6 bg-[#30475E] text-white p-2 text-center rounded-full">
                        Kết quả xử lý</h1>
                    <form id="uploadFormx" class="space-y-4">
                        <!-- 4. Loading icon -->
                        <div id="loading" class="loading text-center py-4">
                            <i class="fas fa-spinner fa-spin text-blue-500 text-2xl"></i>
                            <p class="mt-2 text-gray-600">Đang xử lý...</p>

                        </div>
                    </form>

                    <!-- 5. Kết quả hình ảnh -->
                    <div id="resultContainer" class="mt-4">
                        <div id="imagePreview"
                            class="preview-image sm:flex xs:grid justify-center gap-4 xs:h-auto sm:h-[55vh]">
                            <img class="object-cover rounded-lg cursor-pointer"
                                src="https://i.pinimg.com/736x/05/2c/cd/052ccd66002a159e8b24dc54bf47dd5e.jpg"
                                alt="Uploaded image">
                            <img class="object-cover rounded-lg cursor-pointer"
                                src="https://i.pinimg.com/736x/df/7c/6c/df7c6c6452e5948b61f03e64cd76bd4f.jpg"
                                alt="Uploaded image">
                            <!-- <img class="object-cover rounded-lg cursor-pointer"
                                src="https://i.pinimg.com/736x/5f/a6/93/5fa693caa75e74ae9acd3f692600677d.jpg"
                                alt="Uploaded image">
                            <img class="object-cover rounded-lg cursor-pointer"
                                src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSXWXXM1fOE9_a8NNdP5O_BONAgUolS41iwcw&s"
                                alt="Uploaded image"> -->
                        </div>


                        <p id="resultText" class=" mt-2 text-sm text-gray-600"><span></span></p>
                    </div>
                    <!-- Nút chỉ hiện ở Autolook V2 -->
                    <div id="editAgainWrap" class="mt-3 hidden">
                        <button id="editAgainBtn" type="button"
                            class="inline-flex items-center gap-2 px-4 py-2 rounded-full bg-[#30475e] text-white font-semibold">
                            <!-- icon tùy ý, có thể bỏ -->
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round" class="lucide lucide-wand-sparkles">
                                <path
                                    d="m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72" />
                                <path d="m14 7 3 3" />
                                <path d="M5 6v4" />
                                <path d="M19 14v4" />
                                <path d="M10 2v2" />
                                <path d="M7 8H3" />
                                <path d="M21 16h-4" />
                                <path d="M11 3H9" />
                            </svg>
                            Chỉnh sửa lại!
                        </button>
                    </div>
                </div>
            </div>
        </div>
        </div>
        <!-- Modal Thông số -->
        <div id="paramsModal" class="fixed inset-0 z-[100] hidden [color-scheme:dark]">
            <!-- overlay -->
            <div id="paramsOverlay" class="absolute inset-0 bg-black/60"></div>

            <!-- panel -->
            <div class="absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2
              w-[520px] max-w-[95vw] rounded-2xl shadow-2xl overflow-hidden
              bg-[#1f1f1f] text-white">
                <!-- header -->
                <div class="flex items-center justify-between px-5 py-3 bg-[#2a2a2a]">
                    <h3 class="font-semibold text-lg">Thông số</h3>
                    <button id="paramsClose" class="p-2 rounded-lg hover:bg-white/10">
                        <i class="fa-solid fa-xmark"></i>
                    </button>
                </div>

                <!-- body: dạng list giống UI ảnh -->
                <div class="divide-y divide-white/10">
                    <!-- item -->
                    <div class="flex items-center justify-between px-5 py-3">
                        <div class="text-sm opacity-90">seed</div>
                        <input id="p-seed" type="number" step="1" value="18043870723184"
                            class="w-60 bg-transparent border border-white/20 rounded px-3 py-1.5 text-right focus:outline-none focus:ring-2 focus:ring-pink-500">
                    </div>
                    <div class="flex items-center justify-between px-5 py-3">
                        <div class="text-sm opacity-90">control_after_generate</div>
                        <select id="p-control-after"
                            class="w-60 bg-transparent border border-white/20 rounded px-3 py-1.5 text-right">
                            <option value="randomize">randomize</option>
                            <option value="fix">fix</option>
                            <option value="keep">keep</option>
                        </select>
                    </div>
                    <div class="flex items-center justify-between px-5 py-3">
                        <div class="text-sm opacity-90">steps</div>
                        <input id="p-steps" type="number" min="1" max="100" value="8"
                            class="w-60 bg-transparent border border-white/20 rounded px-3 py-1.5 text-right">
                    </div>
                    <div class="flex items-center justify-between px-5 py-3">
                        <div class="text-sm opacity-90">cfg</div>
                        <input id="p-cfg" type="number" step="0.1" min="0" value="1.0"
                            class="w-60 bg-transparent border border-white/20 rounded px-3 py-1.5 text-right">
                    </div>
                    <div class="flex items-center justify-between px-5 py-3">
                        <div class="text-sm opacity-90">sampler_name</div>
                        <select id="p-sampler"
                            class="w-60 bg-transparent border border-white/20 rounded px-3 py-1.5 text-right">
                            <option>euler</option>
                            <option>euler_a</option>
                            <option>ddim</option>
                            <option>ddpm</option>
                        </select>
                    </div>
                    <div class="flex items-center justify-between px-5 py-3">
                        <div class="text-sm opacity-90">scheduler</div>
                        <select id="p-scheduler"
                            class="w-60 bg-transparent border border-white/20 rounded px-3 py-1.5 text-right">
                            <option>beta</option>
                            <option>karras</option>
                            <option>exponential</option>
                        </select>
                    </div>
                    <div class="flex items-center justify-between px-5 py-3">
                        <div class="text-sm opacity-90">denoise</div>
                        <input id="p-denoise" type="number" step="0.01" min="0" max="1" value="1.00"
                            class="w-60 bg-transparent border border-white/20 rounded px-3 py-1.5 text-right">
                    </div>
                </div>

                <!-- footer -->
                <div class="flex items-center justify-end gap-2 px-5 py-3 bg-[#2a2a2a]">
                    <button id="paramsCancel" class="px-4 py-2 rounded-lg bg-white/10 hover:bg-white/20">Hủy</button>
                    <button id="paramsSave"
                        class="px-4 py-2 rounded-lg bg-gradient-to-r from-pink-500 to-red-400 font-semibold">
                        Lưu & đóng
                    </button>
                </div>
            </div>
        </div>
        <script>
            (function () {
                const btn = document.getElementById('paramsBtn');
                const modal = document.getElementById('paramsModal');
                const overlay = document.getElementById('paramsOverlay');
                const closeX = document.getElementById('paramsClose');
                const cancel = document.getElementById('paramsCancel');
                const save = document.getElementById('paramsSave');

                const open = () => modal.classList.remove('hidden');
                const close = () => modal.classList.add('hidden');

                btn?.addEventListener('click', open);
                overlay?.addEventListener('click', close);
                closeX?.addEventListener('click', close);
                cancel?.addEventListener('click', close);
                document.addEventListener('keydown', (e) => { if (e.key === 'Escape') close(); });

                // Lưu về state toàn cục nếu bạn cần dùng khi “Thực hiện”
                window.currentParams = {
                    seed: 18043870723184, control_after_generate: 'randomize', steps: 8,
                    cfg: 1.0, sampler_name: 'euler', scheduler: 'beta', denoise: 1.00
                };

                // Prefill input theo state
                const setVal = (id, v) => { const el = document.getElementById(id); if (el) el.value = v; };
                const prefill = () => {
                    setVal('p-seed', window.currentParams.seed);
                    setVal('p-control-after', window.currentParams.control_after_generate);
                    setVal('p-steps', window.currentParams.steps);
                    setVal('p-cfg', window.currentParams.cfg);
                    setVal('p-sampler', window.currentParams.sampler_name);
                    setVal('p-scheduler', window.currentParams.scheduler);
                    setVal('p-denoise', window.currentParams.denoise);
                };
                prefill();

                save?.addEventListener('click', () => {
                    window.currentParams = {
                        seed: Number(document.getElementById('p-seed').value || 0),
                        control_after_generate: document.getElementById('p-control-after').value,
                        steps: Number(document.getElementById('p-steps').value || 0),
                        cfg: Number(document.getElementById('p-cfg').value || 0),
                        sampler_name: document.getElementById('p-sampler').value,
                        scheduler: document.getElementById('p-scheduler').value,
                        denoise: Number(document.getElementById('p-denoise').value || 0),
                    };
                    close();
                    // TODO: truyền currentParams vào pipeline thực thi của bạn khi bấm “Thực hiện”.
                    // Ví dụ:
                    // runJob({ ...window.currentParams, ...otherInputs });
                    console.log('Saved params:', window.currentParams);
                });
            })();
        </script>

        <script>
            document.addEventListener("DOMContentLoaded", function () {
                const modelSelect = document.getElementById("model-select");
                const promptUpsampling = document.querySelector(".flex.items-center.md\\:pl-3");
                const ratioDropdown = document.querySelector(".relative.w-\\[10rem\\]");
                const submitCount = document.querySelector("#submitBtn .font-bold");

                // Cha chứa cả 2 bên
                const actionBar = document.querySelector(".flex.lg\\:flex-row.xs\\:flex-col.justify-between.items-center");
                // Nhóm phải = cụm chứa select + nút
                const rightGroup = document.getElementById("model-select")?.closest(".flex.xs\\:flex-col.sm\\:flex-row.gap-3.items-center");

                function applyUI() {
                    const isUltra = modelSelect && modelSelect.value === "v2";

                    // Ẩn/hiện Prompt Upsampling + Dropdown tỉ lệ
                    if (promptUpsampling) promptUpsampling.style.display = isUltra ? "none" : "flex";
                    if (ratioDropdown) ratioDropdown.style.display = isUltra ? "none" : "block";

                    // Đổi số trên nút Thực hiện
                    if (submitCount) submitCount.textContent = isUltra ? "1.5" : "1";

                    // Layout: để khối giãn full hàng và đẩy nhóm phải về mép phải khi Ultra
                    if (actionBar) actionBar.classList.add("w-full");
                    if (rightGroup) {
                        rightGroup.classList.toggle("ml-auto", isUltra);   // Ultra => sát lề phải
                        rightGroup.classList.toggle("ml-auto", isUltra);   // đảm bảo áp dụng
                        if (!isUltra) rightGroup.classList.remove("ml-auto"); // Classic => bỏ
                    }
                }

                applyUI();
                if (modelSelect) modelSelect.addEventListener("change", applyUI);
            });
        </script>



        <script>
            document.getElementById('model-select').addEventListener('change', function () {
                const selection = this.value;
                const feedback = document.getElementById('selection-feedback');
                const backdrop = document.getElementById('modal-backdrop');
                const v1Feedback = document.getElementById('v1-feedback');
                const v2Feedback = document.getElementById('v2-feedback');

                feedback.classList.remove('hidden');
                backdrop.classList.remove('hidden');
                v1Feedback.classList.add('hidden');
                v2Feedback.classList.add('hidden');

                if (selection === 'v1') {
                    v1Feedback.classList.remove('hidden');
                    document.querySelector('.select-custom').classList.remove('bg-emerald-500');
                    document.querySelector('.select-custom').classList.add('bg-indigo-600');
                } else if (selection === 'v2') {
                    v2Feedback.classList.remove('hidden');
                    document.querySelector('.select-custom').classList.remove('bg-indigo-600');
                    document.querySelector('.select-custom').classList.add('bg-emerald-500');
                }
            });

            // Close modal when clicking close button or backdrop
            document.getElementById('close-modal').addEventListener('click', closeModal);
            document.getElementById('modal-backdrop').addEventListener('click', closeModal);

            function closeModal() {
                document.getElementById('selection-feedback').classList.add('hidden');
                document.getElementById('modal-backdrop').classList.add('hidden');
            }
        </script>
        <script>
            $(document).ready(function () {
                function func_get_image_result() {

                }
                $('#imageInput').change(function (event) {
                    var file = event.target.files[0];
                    if (file) {
                        var reader = new FileReader();
                        reader.onload = function (e) {
                            $('#previewImage').attr('src', e.target.result).show();
                        }
                        reader.readAsDataURL(file);
                    }
                });
                // Xử lý sự kiện submit form
                $('#uploadForm').on('submit', function (e) {
                    e.preventDefault();

                    // Hiển thị loading
                    $('#loading').show();
                    $('#submitBtn').prop('disabled', true);
                    $('#resultContainer').addClass('hidden');
                    $('#resultText').text('');

                    // Lấy dữ liệu từ form
                    const imageFile = $('#imageInput')[0].files[0];
                    const content = $('#content').val();
                    const aspect_ratio = $('#aspect_ratio').val();

                    // Tạo FormData để gửi file
                    const formData = new FormData();
                    formData.append('image', imageFile);
                    formData.append('content', content);
                    formData.append('aspect_ratio', aspect_ratio);

                    // Gửi AJAX request
                    $.ajax({
                        url: 'upload.php', // Thay đổi thành endpoint của bạn
                        type: 'POST',
                        data: formData,
                        processData: false,
                        contentType: false,
                        success: function (response) {
                            // Xử lý kết quả thành công
                            try {
                                // const data = JSON.parse(response);
                                const data = (response);
                                if (data.result && data.result.saved_file) {
                                    if (data.result.check_image_ready_data.sample != "") {
                                        var image_url = window.location.origin + '/' + data.result.saved_file;
                                        $('#resultText').html(`<span>Upload thành công! <a target="_blank" href="${image_url}" class="inline-text text-inline w-fullx flexx justify-center py-0 px-4 border border-transparent
                        rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700
                        focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500" style=" display: inline-block; ">Tải về</a></span>`);
                                        $('#imagePreview').html(`<img src="${image_url}" alt="Uploaded image" class="rounded-md">`);
                                        $('#imagePreview').show();
                                    } else {
                                        $('#resultText').text('Có lỗi xảy ra, vui lòng thử lại!');
                                    }
                                    $('#resultContainer').removeClass('hidden');
                                } else {
                                    if (data.url) {
                                        // $('#imagePreview').html(`<img src="${data.url}" alt="Uploaded image" class="rounded-md">`);
                                        $('#resultText').text('Có lỗi xảy ra, vui lòng thử lại!');
                                        $('#resultContainer').removeClass('hidden');
                                    } else {
                                        // $('#resultText').text('Có lỗi xảy ra: ' + (data.error || 'Vui lòng thử lại!'));
                                        $('#resultText').html('Có lỗi xảy ra: ' + (data.error || 'Vui lòng thử lại!'));

                                        $('#resultContainer').removeClass('hidden');
                                    }
                                }
                            } catch (e) {
                                $('#resultText').text('Lỗi phân tích phản hồi từ server');
                                $('#resultContainer').removeClass('hidden');
                            }
                        },
                        error: function (xhr, status, error) {
                            $('#resultText').text('Lỗi: ' + error);
                            $('#resultContainer').removeClass('hidden');
                        },
                        complete: function () {
                            $('#loading').hide();
                            $('#submitBtn').prop('disabled', false);
                        }
                    });
                });

                // Xử lý tất cả các thẻ a để ngăn chặn hành vi mặc định
                $(document).on('click', 'a', function (e) {
                    // e.preventDefault();
                    // Có thể thêm logic điều hướng tại đây nếu cần
                });
            });
        </script>
        <style>
            .vitri3 {
                bottom: 50px;
                right: 0;
            }

            .tienichcuocgoi {
                position: fixed;
                z-index: 999;
            }

            .tienichcuocgoi ul {
                padding: 10px 10px;
                width: 60px;
            }

            .tienichcuocgoi ul li {
                margin-bottom: 10px;
                position: relative;
                display: flex;
            }

            .tienichcuocgoi ul li .icimg,
            .tienichcuocgoi ul li .tienichname {
                float: right;
                position: absolute;
                display: flex;
            }

            .tienichcuocgoi ul li img {
                width: 40px;
                height: 40px;

                border-radius: 50%;
            }

            .tienichcuocgoi ul li a {
                line-height: 40px;
                height: 40px;
                min-width: 40px;
            }

            .tienich_lenh {
                width: 40px;
                height: 40px;
                background-color: var(--ws-bg-title);
                color: var(--ws-color-title);
                border-radius: 50%;
                text-align: center;
                line-height: 40px;
                margin: 5px 10px;
                cursor: pointer;
                display: none;
            }

            .tienich_lenh i {
                font-size: 25px;
            }

            .tienichcuocgoi ul li .icimg {
                z-index: 9;
                float: right;
                right: 0;
            }

            .tienichcuocgoi ul li a:hover .icimg {
                -webkit-animation: phonering-alo-circle-img-anim 1s infinite ease-in-out;
                animation: phonering-alo-circle-img-anim 1s infinite ease-in-out;
                -webkit-transform-origin: 50% 50%;
                -ms-transform-origin: 50% 50%;
                transform-origin: 50% 50%;
                display: -webkit-box;
                display: -webkit-flex;
                display: -ms-flexbox;
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .tienichcuocgoi ul li .tienichname {
                display: none;
                width: 0px;
                position: absolute;
                white-space: nowrap;
                box-shadow: 0px 0px 2px #00000057;
                transition: min-width 1s;
                z-index: 8;
                right: 0;
            }

            .tienichcuocgoi ul li a:hover .tienichname {
                width: auto;
                display: block;
                right: 0px;
                background-color: #FFF;
                box-shadow: 0px 0px 2px #00000057;
                border-radius: 40px;
                padding: 0px 45px 0px 15px;
            }

            .tienichcuocgoi ul li.sodienthoai a {
                padding-right: 13px;
                color: #F00;
                font-size: 20px;
                text-transform: uppercase;
                font-weight: bold;
                font-family: 'ws-font-title', Arial, sans-serif;
            }

            .autolook-alo-phone {
                background-color: transparent;
                cursor: pointer;
                height: 40px;
                width: 40px;
                position: fixed;
                transition: visibility 0.5s ease 0s;
                z-index: 200000;
            }

            .autolook-alo-phone.autolook-alo-green .autolook-alo-ph-circle {
                border-color: #005c91;
                opacity: 1;
            }

            .autolook-alo-ph-circle {
                animation: 2s ease-in-out 0s normal none infinite running autolook-alo-circle-anim;
                background-color: #ff8383;
                border: 2px solid #fc2020;
                border-radius: 100%;
                width: 40px;
                height: 40px;
                left: 0px;
                opacity: 0.1;
                position: absolute;
                top: 2px;
                transform-origin: 50% 50% 0;
                transition: all 0.5s ease 0s;
            }

            .autolook-alo-phone.autolook-alo-green .autolook-alo-ph-circle-fill {
                background-color: #f072724d;
            }

            .autolook-alo-ph-circle-fill {
                animation: 2.3s ease-in-out 0s normal none infinite running autolook-alo-circle-fill-anim;
                border: 2px solid transparent;
                border-radius: 100%;
                height: 40px;
                width: 40px;

                position: absolute;
                transform-origin: 50% 50% 0;
                transition: all 0.5s ease 0s;
            }

            .autolook-alo-phone.autolook-alo-green .autolook-alo-ph-img-circle {
                background-color: #ff3434;
            }

            .autolook-alo-ph-img-circle {
                border: 2px solid transparent;
                border-radius: 100%;
                width: 40px;

                height: 40px;
                opacity: 1;
                transform-origin: 50% 50% 0;
            }

            img.lac {
                -webkit-animation: phonering-alo-circle-img-anim 1s infinite ease-in-out;
                animation: phonering-alo-circle-img-anim 1s infinite ease-in-out;
                -webkit-transform-origin: 50% 50%;
                -ms-transform-origin: 50% 50%;
                transform-origin: 50% 50%;
                display: -webkit-box;
                display: -webkit-flex;
                display: -ms-flexbox;
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .tienichcuocgoi.themes4 ul li a .icimg {
                -webkit-animation: phonering-alo-circle-img-anim 1s infinite ease-in-out;
                animation: phonering-alo-circle-img-anim 1s infinite ease-in-out;
                -webkit-transform-origin: 50% 50%;
                -ms-transform-origin: 50% 50%;
                transform-origin: 50% 50%;
                display: -webkit-box;
                display: -webkit-flex;
                display: -ms-flexbox;
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .tienichcuocgoi.themes4.vitri3 ul li.sodienthoai a .tienichname {
                left: unset;
                width: auto;
                background-color: #FFF;
                box-shadow: 0px 0px 2px #00000057;
                border-radius: 40px;
                font-size: 18px
            }

            a:where(:not(.wp-element-button)) {
                text-decoration: none;
            }

            /*! autolook keyframes */
            @keyframes phonering-alo-circle-img-anim {
                0% {
                    -webkit-transform: rotate(0) scale(1) skew(1deg);
                }

                10% {
                    -webkit-transform: rotate(-25deg) scale(1) skew(1deg);
                }

                20% {
                    -webkit-transform: rotate(25deg) scale(1) skew(1deg);
                }

                30% {
                    -webkit-transform: rotate(-25deg) scale(1) skew(1deg);
                }

                40% {
                    -webkit-transform: rotate(25deg) scale(1) skew(1deg);
                }

                50% {
                    -webkit-transform: rotate(0) scale(1) skew(1deg);
                }

                100% {
                    -webkit-transform: rotate(0) scale(1) skew(1deg);
                }
            }
        </style>
        <div class="tienichcuocgoi vitri3 themes4">
            <ul id="ultienichcuocgoi">
                <li class="sodienthoaizalo">
                    <a rel="noopener nofflow" target="_blank" href="https://zalo.me/0898485555"
                        data-original-title="Nhắn tin cho chúng tôi qua Zalo" data-placement="top"
                        data-toggle="tooltip">
                        <span class="icimg">
                            <img width="40" height="40" alt="sodienthoaizalo" src="images/sodienthoaizalo.svg">
                        </span>
                        <span class="tienichname">0898485555</span>
                    </a>
                </li>
                <li class="facebook">
                    <a rel="noopener nofflow" target="_blank" href="https://www.facebook.com/HieuLeAI.Agency"
                        data-original-title="Nhắn tin cho chúng tôi qua Facebook" data-placement="top"
                        data-toggle="tooltip">
                        <span class="icimg">
                            <img alt="facebook" src="images/facebook.svg">
                        </span>
                        <span class="tienichname">HieuLeAI.Agency</span>
                    </a>
                </li>
                <li class="sodienthoai">
                    <a rel="noopener nofflow" href="tel:0898485555" data-original-title="Nhấn để gọi ngay"
                        data-placement="top" data-toggle="tooltip">
                        <span class="icimg">
                            <img width="40" height="40" class="lac" alt="sodienthoai" src="images/phone-call.svg">
                            <div class="autolook-alo-ph-circle"></div>
                            <div class="autolook-alo-ph-circle-fill"></div>
                        </span>
                        <span class="tienichname">0898485555</span>
                    </a>
                </li>
            </ul>
        </div>

        <script>
            if (true || window.innerWidth < 768) {
                // Mobile menu toggle
                const mobileMenuButton = document.getElementById('mobile-menu-button');
                const mobileMenu = document.getElementById('mobile-menu');

                mobileMenuButton.addEventListener('click', () => {
                    mobileMenu.classList.toggle('hidden');
                    mobileMenu.classList.toggle('-translate-x-full');
                });

                // Đóng menu khi click ra ngoài
                document.addEventListener('click', function (e) {
                    const isClickInsideMenu = mobileMenu.contains(e.target);
                    const isClickOnButton = mobileMenuButton.contains(e.target);

                    if (!isClickInsideMenu && !isClickOnButton && !mobileMenu.classList.contains('hidden')) {
                        mobileMenu.classList.add('hidden');
                        mobileMenu.classList.add('-translate-x-full');
                    }
                });

                // Mobile lịch sử chat
                const mobileChatButton = document.getElementById('tongle-chat-history');
                const mobileChatHistory = document.getElementById('slidebar-chat');

                mobileChatButton.addEventListener('click', () => {
                    mobileChatHistory.classList.toggle('hidden');
                    mobileChatHistory.classList.toggle('-translate-x-full');
                });


                // Đóng menu khi click ra ngoài
                document.addEventListener('click', function (e) {
                    const isClickInsideMenu = mobileChatHistory.contains(e.target);
                    const isClickOnButton = mobileChatButton.contains(e.target);

                    if (!isClickInsideMenu && !isClickOnButton && !mobileChatHistory.classList.contains('hidden')) {
                        mobileChatHistory.classList.add('hidden');
                        mobileChatHistory.classList.add('-translate-x-full');
                    }
                });
                // Mobile products menu toggle
                const mobileProductsButton = document.getElementById('mobile-products-button');
                const mobileProductsMenu = document.getElementById('mobile-products-menu');

                mobileProductsButton.addEventListener('click', () => {
                    mobileProductsMenu.classList.toggle('hidden');
                    const icon = mobileProductsButton.querySelector('i');
                    icon.classList.toggle('fa-chevron-down');
                    icon.classList.toggle('fa-chevron-up');
                });

                // Prevent default for all anchor tags
                document.querySelectorAll('a').forEach(link => {
                    link.addEventListener('click', (e) => {
                        if (link.getAttribute('href') === '#') {
                            e.preventDefault();
                        }
                    });
                });
            }
            function toggleTooltip() {
                const tooltip = document.getElementById('tooltip');
                tooltip.classList.toggle('hidden');
            }
            function toggleTooltip2() {
                const tooltip = document.getElementById('tooltip2');
                tooltip.classList.toggle('hidden');
            }
            // Optional: ẩn khi click ngoài
            document.addEventListener('click', function (e) {
                const tooltip = document.getElementById('tooltip');
                const trigger = tooltip.previousElementSibling;
                if (!tooltip.contains(e.target) && !trigger.contains(e.target)) {
                    tooltip.classList.add('hidden');
                }
            });
            function toggleDropdown() {
                document.getElementById("customDropdown").classList.toggle("hidden");
            }

            function selectRatio(ratio) {
                document.getElementById("selectedRatio").innerText = ratio + " ▼";
                document.getElementById("customDropdown").classList.add("hidden");

                // Bạn có thể xử lý giá trị ratio ở đây
                console.log("Đã chọn tỉ lệ:", ratio);
            }
            function toggleDropdown2() {
                document.getElementById("customDropdown2").classList.toggle("hidden");
            }

            function selectRatio2(ratio) {
                document.getElementById("selectedRatio2").innerText = ratio + " ▼";
                document.getElementById("customDropdown2").classList.add("hidden");

                // Bạn có thể xử lý giá trị ratio ở đây
                console.log("Đã số lượng ảnh:", ratio);
            }

            // Đóng dropdown khi click ra ngoài
            document.addEventListener("click", function (e) {
                // Dropdown tỷ lệ ảnh
                const dropdown1 = document.getElementById("customDropdown");
                const button1 = document.getElementById("selectedRatio");
                if (!dropdown1.contains(e.target) && !button1.contains(e.target)) {
                    dropdown1.classList.add("hidden");
                }

                // Dropdown số lượng ảnh
                const dropdown2 = document.getElementById("customDropdown2");
                const button2 = document.getElementById("selectedRatio2");
                if (!dropdown2.contains(e.target) && !button2.contains(e.target)) {
                    dropdown2.classList.add("hidden");
                }
            });

        </script>
        <!-- POPUP -->
        <div id="popupContainer"
            class="bg-[url('https://w.ladicdn.com/668665e58fb7e80020232e3b/bg-20250724100845-bkivz.png')] bg-cover bg-center bg-no-repeat  hidden fixed inset-0 !bg-[#F5F5F5] z-[9999] flex items-center justify-center">
            <div class="absolute inset-0 bg-black/30 z-0"></div>
            <div
                class="w-full h-full rounded-none p-4 overflow-auto relative text-center shadow-lg flex flex-col justify-center items-center">


                <!-- Action Buttons -->
                <div class="absolute top-3 xs:left-[15%] sm:left-[45%] flex gap-5 text-white text-lg z-50">

                    <button onclick="toggleCompareImage()" title="Compare image" class="hover:scale-110 duration-200">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                            class="lucide lucide-columns2 size-5 font-bold">
                            <rect width="18" height="18" x="3" y="3" rx="2"></rect>
                            <path d="M12 3v18"></path>
                        </svg>
                    </button>
                    <button onclick="copyImageLink()" title="Copy link" class="hover:scale-110 duration-200">
                        <i class="fas fa-link"></i>
                    </button>
                    <button onclick="toggleFullscreen()" title="Full screen" class="hover:scale-110 duration-200">
                        <i class="fas fa-expand"></i>
                    </button>
                    <button onclick="likeImage()" title="Like" class="hover:scale-110 duration-200">
                        <i class="far fa-heart" id="likeIcon"></i>
                    </button>

                    <a id="downloadImage" href="#" download
                        class="bg-[#2e2e2e] text-white px-4 py-1 text-base rounded hover:bg-gray-400">Tải xuống</a>
                </div>
                <!-- Đóng -->
                <button onclick="closePopup()"
                    class="absolute top-2 right-4 text-white text-3xl font-bold">&times;</button>



                <!-- Ảnh -->
                <div id="compareWrapper" class="flex md:flex-row xs:flex-col justify-center items-center w-full">
                    <!-- Ảnh gốc (3 ảnh + dấu +) -->
                    <div id="originalWrapper" class="relative flex items-center gap-2 h-full transition-fade">
                        <div id="originalGrid" class="flex items-center gap-2 !w-auto h-full">
                            <div class="relative">
                                <img class=" rounded-2xl shadow-lg object-cover  !h-[75vh] !w-[50vh]" alt="Ảnh gốc 1"
                                    src="https://i.imghippo.com/files/nSi9406oH.jpeg">
                                <div class="absolute top-2 left-2 bg-black/70 text-white text-sm px-2 py-1 rounded">Ảnh
                                    sản phẩm</div>
                            </div>
                            <span class="plus-sign text-4xl font-bold">+</span>
                            <div class="relative">
                                <img class=" rounded-2xl shadow-lg object-cover  !h-[75vh] !w-[50vh]" alt="Ảnh gốc 2"
                                    src="https://i.imghippo.com/files/nSi9406oH.jpeg">
                                <div class="absolute top-2 left-2 bg-black/70 text-white text-sm px-2 py-1 rounded">Ảnh
                                    sản phẩm</div>
                            </div>
                            <span class="plus-sign text-4xl font-bold">+</span>
                            <div class="relative">
                                <img class=" rounded-2xl shadow-lg object-cover  !h-[75vh] !w-[50vh]" alt="Ảnh gốc 3"
                                    src="https://i.imghippo.com/files/nSi9406oH.jpeg">
                                <div class="absolute top-2 left-2 bg-black/70 text-white text-sm px-2 py-1 rounded">Ảnh
                                    sản phẩm</div>
                            </div>
                            <span class="text-5xl font-bold mx-4">=</span>
                        </div>
                    </div>

                    <!-- Dấu = -->

                    <!-- Ảnh đã xử lý -->
                    <!-- <div class="relative">
        <img id="popupImage" src="processed-image.png" class="h-[75vh] !w-full rounded-md shadow-lg object-cover" alt="Phóng to">
        <div id="processedLabel" class="absolute top-2 left-2 bg-black/70 text-white text-sm px-2 py-1 rounded">Ảnh đã xử lý</div>
    </div> -->
                    <div id="popupImage" class="select-none ">
                        <div id="compareBox"
                            class="popupImage relative !h-[75vh] xs:!w-[42vh] sm:!w-[50vh] overflow-hidden rounded-2xl shadow-lg ">
                            <img src="https://i.imghippo.com/files/tPjm9279QE.png" alt="Upscaled" id="imgBottom"
                                class="absolute top-0 left-0 w-full !h-full object-cover pointer-events-none">
                            <img src="https://i.imghippo.com/files/nSi9406oH.jpeg" alt="Original" id="imgTop"
                                class="absolute top-0 left-0 w-full h-full object-cover pointer-events-none z-20"
                                style="clip-path: inset(0 50% 0 0);">
                            <div id="sliderBar"
                                class="absolute top-0 h-full w-[3px] bg-gray-400 z-30 translate-x-[-50%] left-1/2 cursor-ew-resize">
                            </div>
                            <div id="sliderHandle"
                                class="absolute top-1/2 left-1/2 w-5 h-5 bg-gray-600 border-4 border-white rounded-full z-40 translate-x-[-50%] translate-y-[-50%] shadow-md cursor-pointer">
                            </div>
                            <div id="processedLabel"
                                class="absolute top-2 left-2 bg-black/70 text-white text-sm px-2 py-1 rounded">Ảnh đã xử
                                lý</div>
                        </div>
                    </div>
                </div>
            </div>






            <!-- Nội dung -->
            <!-- <div class="bg-white py-3 px-5  mt-5 rounded-xl shadow-xl">
                    <p class="text-lg font-semibold text-gray-800">Ảnh được xử lý thành công</p>
                    <p class="text-sm text-gray-500">Bạn có thể tải hoặc tạo biến thể từ ảnh này.</p>
                </div> -->

            <div
                class="sm:flex xs:grid w-full xs:justify-center sm:justify-between items-center gap-4 absolute xs:bottom-4 sm:bottom-6 px-5">
                <div class="xs:flex sm:hidden justify-center">
                    <button
                        class=" bg-[#2e2e2e] text-white px-4 py-1 rounded hover:bg-gray-400 flex items-center gap-2"><svg
                            xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                            class="lucide lucide-wand-sparkles size-4 w-3.5 h-3.5">
                            <path
                                d="m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72">
                            </path>
                            <path d="m14 7 3 3"></path>
                            <path d="M5 6v4"></path>
                            <path d="M19 14v4"></path>
                            <path d="M10 2v2"></path>
                            <path d="M7 8H3"></path>
                            <path d="M21 16h-4"></path>
                            <path d="M11 3H9"></path>
                        </svg>Edit</button>
                </div>
                <div class="bg-[#2e2e2e] text-white px-4 py-1 rounded flex relative sm:text-start xs:text-center">
                    <span>Generate: </span>
                    <span id="promptSummary" onclick="togglePromptPopup()"
                        class="select-none cursor-pointer block max-w-[300px] truncate whitespace-nowrap overflow-hidden ml-1 hover:underline">Prompt
                        sử dụng lên ảnh này</span>
                </div>

                <!-- Popup -->
                <div id="promptPopup" class="hidden  inset-0 z-[9999]  absolute select-none">
                    <div
                        class="bg-white w-[80%] max-w-[400px] rounded-lg shadow-lg p-2  absolute bottom-[40px] sm:left-[1.2rem] xs:left-[2.6rem] ">
                        <!-- Close -->
                        <!-- Prompt Title -->
                        <div class="flex justify-between ">
                            <h2 class="text-base font-semibold text-[#999999] mb-3 text-start">Prompt</h2>
                            <button onclick="togglePromptPopup()"
                                class=" text-2xl font-bold text-gray-600 hover:text-black flex items-start">
                                &times;
                            </button>
                        </div>

                        <div>


                            <!-- Prompt Text -->
                            <textarea id="promptText" class="w-full rounded-lg text-sm resize-none" readonly></textarea>

                            <!-- Copy Button -->
                            <div class="flex justify-end">
                                <button id="copyPromptButton" onclick="copyPromptText()"
                                    class="flex items-center justify-center bg-[#2e2e2e] text-white px-4 py-2 rounded hover:bg-gray-700 text-sm w-full">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 mr-2" fill="none"
                                        viewBox="0 0 24 24" stroke="currentColor">
                                        <rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect>
                                        <path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path>
                                    </svg>
                                    Copy
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- <div class="sm:block xs:hidden">
                    <button
                        class=" bg-[#2e2e2e] text-white px-4 py-1 rounded hover:bg-gray-400 flex items-center gap-2"><svg
                            xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                            class="lucide lucide-wand-sparkles size-4 w-3.5 h-3.5">
                            <path
                                d="m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72">
                            </path>
                            <path d="m14 7 3 3"></path>
                            <path d="M5 6v4"></path>
                            <path d="M19 14v4"></path>
                            <path d="M10 2v2"></path>
                            <path d="M7 8H3"></path>
                            <path d="M21 16h-4"></path>
                            <path d="M11 3H9"></path>
                        </svg>Edit</button>
                </div> -->
            </div>
        </div>
        <div id="v2PopupContainer" class="fixed inset-0 z-[999] hidden ">
            <div id="v2Backdrop" class="absolute inset-0 bg-black/60"></div>

            <div class="absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 
              bg-[url('https://w.ladicdn.com/668665e58fb7e80020232e3b/bg-20250724100845-bkivz.png')] dark:bg-[#1f1f1f] rounded-2xl shadow-2xl 
              w-[min(90vw,900px)] p-4">
                <button id="v2Close"
                    class="absolute top-2 right-2 p-2 rounded-full bg-black/50 text-white w-[30px] h-[30px]">
                    <i class="absolute right-0 left-0 top-2 fa-solid fa-xmark"></i>
                </button>

                <div class="flex flex-col gap-3">
                    <img id="v2PopupImage" src="" alt="" class="w-fit mx-auto max-h-[70vh] object-contain rounded-xl" />

                    <div class="flex gap-2">
                        <input id="v2Text" type="text" placeholder="Ghi chú / prompt bổ sung..."
                            class="flex-1 border border-gray-300 rounded-xl px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                        <!-- Bạn sẽ tự redesign button này theo ý thích -->
                        <button id="v2RerunBtn" class="rounded-xl px-4 py-2 bg-[#30475E] text-white font-semibold">
                            Thực hiện lại
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <script>
            document.addEventListener('DOMContentLoaded', () => {
                const model = document.getElementById('model-select');
                // chịu cả hai khả năng id: "content" hoặc " content"
                const contentEl = document.getElementById('content') || document.getElementById(' content');
                if (!model || !contentEl) return;

                // Placeholder gốc (V1) – copy đúng nội dung hiện tại
                const PLACEHOLDER_V1 = `- Bạn có thể viết câu lệnh bằng tiếng Việt nếu yêu cầu đơn giản (Bắt buộc bật tính năng Prompt Upsampling). 
- Yêu cầu bạn nên sử dụng ChatBot A.I của Autolook để upload hình ảnh và đưa yêu cầu. Sau đó lấy Prompt tiếng Anh và chỉnh sửa thêm theo ý bạn để có kết quả tốt nhất. Khi có câu lệnh chi tiết bằng tiếng Anh từ ChatBot A.I thì bạn hãy tắt tính năng Prompt Upsampling đi.
- Hãy đọc kỹ hướng dẫn trước khi tạo ảnh để tránh lãng phí credit`;

                // Placeholder cho V2
                const PLACEHOLDER_V2 = `- Bạn có thể sử dụng Tiếng Việt hay Tiếng Anh đều được.
- Hãy đọc kỹ hướng dẫn trước khi tạo ảnh để tránh lãng phí credit
  `;

                const applyPlaceholder = () => {
                    contentEl.placeholder = (model.value === 'v2') ? PLACEHOLDER_V2 : PLACEHOLDER_V1;
                };

                // Áp ngay khi load + khi đổi model
                applyPlaceholder();
                model.addEventListener('change', applyPlaceholder);
            });
        </script>
        <script>
            document.addEventListener('DOMContentLoaded', () => {
                const modelSelect = document.getElementById('model-select');
                const previewWrap = document.getElementById('imagePreview');
                const editWrap = document.getElementById('editAgainWrap');
                const editBtn = document.getElementById('editAgainBtn');

                // Popup V2 sẵn có
                const v2Popup = document.getElementById('v2PopupContainer');
                const v2Img = document.getElementById('v2PopupImage');

                // Ghi nhớ ảnh được chọn gần nhất (nếu user click ảnh)
                let lastClickedSrc = null;
                if (previewWrap) {
                    previewWrap.addEventListener('click', (e) => {
                        const t = e.target;
                        if (t && t.tagName === 'IMG') {
                            lastClickedSrc = t.getAttribute('src') || lastClickedSrc;
                        }
                    });
                }

                // Chỉ hiện nút khi là V2
                function refreshEditBtn() {
                    const isV2 = modelSelect && modelSelect.value === 'v2';
                    if (editWrap) editWrap.classList.toggle('hidden', !isV2);
                }
                refreshEditBtn();
                modelSelect?.addEventListener('change', refreshEditBtn);

                // Bấm nút => mở popup V2 với ảnh đang chọn (hoặc ảnh đầu tiên)
                editBtn?.addEventListener('click', () => {
                    const candidate = lastClickedSrc || previewWrap?.querySelector('img')?.getAttribute('src');
                    if (candidate && v2Img) v2Img.src = candidate;
                    v2Popup?.classList.remove('hidden');
                });
            });
        </script>
        <script>
            (() => {
                const $ = (id) => document.getElementById(id);

                // Phần tử của popup V2 (theo markup bạn đang dùng)
                const v2Popup = $('v2PopupContainer');
                const v2Backdrop = $('v2Backdrop');      // lớp nền tối
                const v2CloseBtn = $('v2Close');         // nút X đóng
                const v2Text = $('v2Text');          // ô input (tuỳ thích reset)
                const v2Img = $('v2PopupImage');    // ảnh (tuỳ thích reset)

                if (!v2Popup) return; // thiếu markup thì bỏ qua

                const openV2 = () => {
                    v2Popup.classList.remove('hidden');
                    document.body.classList.add('overflow-hidden'); // khoá cuộn
                };

                const closeV2 = () => {
                    v2Popup.classList.add('hidden');
                    document.body.classList.remove('overflow-hidden');
                    // Nếu muốn reset trường nhập mỗi lần đóng thì bật 2 dòng dưới:
                    // if (v2Text) v2Text.value = '';
                    // if (v2Img)  v2Img.removeAttribute('src');
                };

                // Đóng bằng nút X
                v2CloseBtn?.addEventListener('click', closeV2);

                // Đóng khi click nền tối
                v2Backdrop?.addEventListener('click', closeV2);

                // Đóng bằng phím Esc
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape' && !v2Popup.classList.contains('hidden')) closeV2();
                });

                // Trường hợp bạn không có #v2Backdrop riêng, mà muốn click ngoài khung cũng đóng:
                // (giữ nguyên nếu đã có #v2Backdrop)
                if (!v2Backdrop) {
                    v2Popup.addEventListener('click', (e) => {
                        // nếu click trúng vùng trống (không phải nội dung), thì đóng
                        const content = v2Popup.querySelector('[data-v2-content]') || v2Popup.querySelector('.rounded-2xl');
                        if (!content || !content.contains(e.target)) closeV2();
                    });
                }

                // Cho nơi khác gọi mở/đóng dễ dàng (nút "Chỉnh sửa lại!" hay click ảnh)
                window.AutolookV2Popup = {
                    open: openV2,
                    close: closeV2,
                    isOpen: () => !v2Popup.classList.contains('hidden')
                };

                // Nếu có nút "Chỉnh sửa lại!" thì tự nối luôn (không bắt buộc)
                const editBtn = $('editAgainBtn');
                editBtn?.addEventListener('click', (e) => {
                    e.preventDefault();
                    openV2();
                });
            })();
        </script>
        <script>
            const container = document.getElementById("compareBox");
            const imgTop = document.getElementById("imgTop");
            const imgBottom = document.getElementById("imgBottom");
            const sliderBar = document.getElementById("sliderBar");
            const sliderHandle = document.getElementById("sliderHandle");

            let isDraggingSlider = false;
            let isDraggingImage = false;
            let zoomLevel = 1;
            let imgOffsetX = 0;
            let imgOffsetY = 0;
            let dragStartX = 0;
            let dragStartY = 0;

            function setSlider(x) {
                const rect = container.getBoundingClientRect();
                let offset = x - rect.left;
                offset = Math.max(0, Math.min(offset, rect.width));
                const percent = offset / rect.width * 100;

                imgTop.style.clipPath = `inset(0 ${100 - percent}% 0 0)`;
                sliderBar.style.left = `${percent}%`;
                sliderHandle.style.left = `${percent}%`;
            }

            function clampOffsets() {
                const containerRect = container.getBoundingClientRect();
                const scaledWidth = containerRect.width * zoomLevel;
                const scaledHeight = containerRect.height * zoomLevel;

                const maxOffsetX = (scaledWidth - containerRect.width) / 2;
                const maxOffsetY = (scaledHeight - containerRect.height) / 2;

                imgOffsetX = Math.max(-maxOffsetX, Math.min(imgOffsetX, maxOffsetX));
                imgOffsetY = Math.max(-maxOffsetY, Math.min(imgOffsetY, maxOffsetY));
            }

            function updateImageTransform() {
                clampOffsets();
                const transform = `scale(${zoomLevel}) translate(${imgOffsetX / zoomLevel}px, ${imgOffsetY / zoomLevel}px)`;
                imgTop.style.transform = transform;
                imgBottom.style.transform = transform;
            }

            // Kéo slider
            sliderHandle.addEventListener("mousedown", (e) => {
                e.preventDefault();
                isDraggingSlider = true;
            });

            window.addEventListener("mousemove", (e) => {
                if (isDraggingSlider) {
                    setSlider(e.clientX);
                } else if (isDraggingImage && zoomLevel > 1) {
                    const deltaX = e.clientX - dragStartX;
                    const deltaY = e.clientY - dragStartY;
                    imgOffsetX += deltaX;
                    imgOffsetY += deltaY;
                    updateImageTransform();
                    dragStartX = e.clientX;
                    dragStartY = e.clientY;
                }
            });

            window.addEventListener("mouseup", () => {
                isDraggingSlider = false;
                isDraggingImage = false;
            });

            // Mobile touch
            sliderHandle.addEventListener("touchstart", (e) => {
                e.preventDefault();
                isDraggingSlider = true;
            });

            window.addEventListener("touchmove", (e) => {
                if (isDraggingSlider) {
                    setSlider(e.touches[0].clientX);
                } else if (isDraggingImage && zoomLevel > 1) {
                    const deltaX = e.touches[0].clientX - dragStartX;
                    const deltaY = e.touches[0].clientY - dragStartY;
                    imgOffsetX += deltaX;
                    imgOffsetY += deltaY;
                    updateImageTransform();
                    dragStartX = e.touches[0].clientX;
                    dragStartY = e.touches[0].clientY;
                }
            });

            window.addEventListener("touchend", () => {
                isDraggingSlider = false;
                isDraggingImage = false;
            });

            // Kéo ảnh khi zoom
            container.addEventListener("mousedown", (e) => {
                if (e.target !== sliderHandle && zoomLevel > 1) {
                    isDraggingImage = true;
                    dragStartX = e.clientX;
                    dragStartY = e.clientY;
                }
            });

            container.addEventListener("touchstart", (e) => {
                if (e.target !== sliderHandle && zoomLevel > 1) {
                    isDraggingImage = true;
                    dragStartX = e.touches[0].clientX;
                    dragStartY = e.touches[0].clientY;
                }
            });

            // Zoom bằng lăn chuột
            container.addEventListener("wheel", (e) => {
                e.preventDefault();
                const delta = -e.deltaY || e.wheelDelta;
                const zoomFactor = delta > 0 ? 1.05 : 0.95;

                const prevZoom = zoomLevel;
                zoomLevel = Math.max(1, Math.min(zoomLevel * zoomFactor, 5)); // Giới hạn zoom 1x-5x

                // Giữ vị trí zoom tại điểm chuột
                const rect = container.getBoundingClientRect();
                const offsetX = e.clientX - rect.left - rect.width / 2;
                const offsetY = e.clientY - rect.top - rect.height / 2;

                imgOffsetX = imgOffsetX * (zoomLevel / prevZoom) + offsetX * (1 - zoomFactor);
                imgOffsetY = imgOffsetY * (zoomLevel / prevZoom) + offsetY * (1 - zoomFactor);

                updateImageTransform();
            });
        </script>
        <script>

            function togglePromptPopup() {
                const popup = document.getElementById("promptPopup");
                const promptText = document.getElementById("promptText");
                const promptSummary = document.getElementById("promptSummary");

                promptText.value = promptSummary ? promptSummary.innerText : '';
                popup.classList.toggle("hidden");
            }

            function copyPromptText() {
                const promptText = document.getElementById("promptText");
                navigator.clipboard.writeText(promptText.value)
                    .then(() => {
                        const btn = document.getElementById("copyPromptButton");
                        btn.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-check w-4 h-4 mr-2"><path d="M20 6 9 17l-5-5"></path></svg> Copied`;
                        setTimeout(() => {
                            btn.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect>
                        <path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path>
                    </svg>
                    Copy`;
                        }, 2000);
                    })
                    .catch(err => {
                        alert("Copy failed: " + err);
                    });
            }

            function toggleCompareImage() {
                const originalWrapper = document.getElementById('originalWrapper');
                const originalGrid = document.getElementById('originalGrid');
                const originalImages = document.querySelectorAll('.original-image');
                const popupImage = document.getElementById('popupImage');
                const processedLabel = document.getElementById('processedLabel');

                // Lấy kích thước ảnh đã xử lý
                const processedWidth = popupImage.clientWidth;
                const processedHeight = popupImage.clientHeight;

                // Cập nhật chiều rộng/lưới cho container 4 ảnh
                originalGrid.style.width = processedWidth + 'px';
                originalGrid.style.height = processedHeight + 'px';

                // Gán ảnh xử lý vào cả 4 ảnh gốc
                originalImages.forEach((img) => {
                    img.src = popupImage.src;
                    img.style.width = (processedWidth / 2 - 8) + 'px'; // 8 = nửa khoảng cách gap-4
                    img.style.height = (processedHeight / 2 - 8) + 'px';
                    img.style.objectFit = 'cover';
                });

                // Hiển thị/ẩn
                if (originalWrapper.classList.contains('show')) {
                    originalWrapper.classList.remove('show');
                    processedLabel.classList.remove('show');
                    setTimeout(() => {
                        originalWrapper.classList.add('hidden');
                        processedLabel.classList.add('hidden');
                    }, 400);
                } else {
                    originalWrapper.classList.remove('hidden');
                    processedLabel.classList.remove('hidden');
                    setTimeout(() => {
                        originalWrapper.classList.add('show');
                        processedLabel.classList.add('show');
                    }, 10);
                }
            }

        </script>

        <script>
            function closePopup() {
                document.getElementById('popupContainer').classList.add('hidden');
            }

            document.addEventListener('DOMContentLoaded', () => {
                const previewContainer = document.getElementById('imagePreview');
                const popupContainer = document.getElementById('popupContainer');
                const popupImage = document.getElementById('popupImage');
                const downloadLink = document.getElementById('downloadImage');

                if (previewContainer) {
                    previewContainer.addEventListener('click', function (event) {
                        const target = event.target;
                        if (target.tagName === 'IMG') {
                            const src = target.getAttribute('src');
                            popupImage.setAttribute('src', src);
                            downloadLink.setAttribute('href', src);
                            popupContainer.classList.remove('hidden');

                            // ✳️ Reset phần so sánh về mặc định: ẩn ảnh gốc và label
                            const originalWrapper = document.getElementById('originalWrapper');
                            const processedLabel = document.getElementById('processedLabel');

                            originalWrapper.classList.add('hidden');
                            processedLabel.classList.add('hidden');
                            originalWrapper.classList.remove('show');
                            processedLabel.classList.remove('show');
                        }
                    });
                }
            });
        </script>


        <script>
            function copyImageLink() {
                const link = document.getElementById('popupImage').src;
                navigator.clipboard.writeText(link).then(() => {
                    alert("Đã sao chép liên kết ảnh!");
                });
            }

            function toggleFullscreen() {
                const popupImage = document.getElementById('popupImage');
                const img = popupImage.querySelector('#imgBottom');

                if (img.requestFullscreen) {
                    img.requestFullscreen();
                } else if (img.webkitRequestFullscreen) {
                    img.webkitRequestFullscreen();
                } else if (img.msRequestFullscreen) {
                    img.msRequestFullscreen();
                }

                // Add class fullscreen-style để chỉ tác động khi fullscreen
                img.classList.add('fullscreen-style');
            }


            function likeImage() {
                const icon = document.getElementById('likeIcon');
                icon.classList.toggle('fas');
                icon.classList.toggle('far');
                icon.classList.toggle('text-red-500');
            }
        </script>


        <script>
            function showImageInfo() {
                document.getElementById('infoModal').classList.remove('hidden');
            }
            function closeImageInfo() {
                document.getElementById('infoModal').classList.add('hidden');
            }
        </script>
        <script>
            //Button Menu
            document.addEventListener('DOMContentLoaded', () => {
                const sidebarLinks = document.querySelectorAll(
                    '.space-y-4.px-2.mt-4 a'
                );

                // Xác định đường dẫn hiện tại để highlight
                const currentUrl = window.location.pathname;

                sidebarLinks.forEach(link => {
                    // Nếu URL khớp -> thêm active
                    if (link.getAttribute('href') && currentUrl.includes(link.getAttribute('href'))) {
                        link.classList.add('sidebar-active');
                    }

                    // Gắn sự kiện click
                    link.addEventListener('click', function () {
                        // Bỏ class ở tất cả
                        sidebarLinks.forEach(l => l.classList.remove('sidebar-active'));

                        // Thêm class vào phần tử vừa click
                        this.classList.add('sidebar-active');
                    });
                });
            });
        </script>
        <!-- ===================== GIFT 24H: HTML (place inside <body>) ===================== -->
        <!-- Modal -->
        <div id="gift24h-modal" class="gift-z fixed inset-0 hidden" aria-hidden="true">
            <div class="absolute inset-0 bg-black/50 gift-glass"></div>
            <div class="flex items-center justify-center min-h-full p-4">
                <div class="relative w-full max-w-2xl rounded-2xl bg-white text-gray-800 shadow-xl overflow-hidden">
                    <button id="gift24h-x" class="absolute right-3 top-3 p-2 rounded-full hover:bg-black/5"
                        aria-label="Đóng">✕</button>

                    <!-- Banner + badge -->
                    <div class="relative">
                        <!-- Đổi ảnh banner theo ý bạn -->
                        <img src="./images/bg-gift.png" alt="Sale Banner" class="w-full h-50 object-cover">

                    </div>
                    <!-- Body -->
                    <div class="p-6 flex flex-col justify-center gap-2">
                        <h2 class="text-4xl font-extrabold text-gray-800 mb-2">FLASH SALE!</h2>
                        <p class="text-gray-600 mb-6">Ưu đãi có hạn trong 24 giờ — đừng bỏ lỡ.</p>
                        <button onclick="window.location.href='./buy-credit.html'" id="gift24h-claim"
                            class="gift-pulse bg-red-500 hover:bg-red-600 text-white font-bold py-3 px-4 rounded-lg flex items-center justify-center transition">
                            <span class="mr-2">🎁</span> Nhận ngay ưu đãi 30% cho toàn bộ gói credit
                        </button>
                        <!-- Countdown grid -->
                        <div class="mb-6">
                            <p class="text-sm text-gray-500 mb-2">Còn lại:</p>
                            <div class="flex justify-between gap-2">
                                <div class="gift-count-item flex flex-col items-center justify-center w-1/4 py-3">
                                    <span id="gift24h-days" class="text-2xl font-bold text-red-500">00</span>
                                    <span class="text-xs text-gray-500">Days</span>
                                </div>
                                <div class="gift-count-item flex flex-col items-center justify-center w-1/4 py-3">
                                    <span id="gift24h-hours" class="text-2xl font-bold text-red-500">00</span>
                                    <span class="text-xs text-gray-500">Hours</span>
                                </div>
                                <div class="gift-count-item flex flex-col items-center justify-center w-1/4 py-3">
                                    <span id="gift24h-minutes" class="text-2xl font-bold text-red-500">00</span>
                                    <span class="text-xs text-gray-500">Minutes</span>
                                </div>
                                <div class="gift-count-item flex flex-col items-center justify-center w-1/4 py-3">
                                    <span id="gift24h-seconds" class="text-2xl font-bold text-red-500">00</span>
                                    <span class="text-xs text-gray-500">Seconds</span>
                                </div>
                            </div>
                        </div>

                        <!-- Alert box (không dùng feather để tránh phụ thuộc) -->
                        <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4">
                            <div class="flex">
                                <div class="flex-shrink-0">
                                    <!-- simple info icon -->
                                    <svg class="h-5 w-5 text-yellow-400" viewBox="0 0 20 20" fill="currentColor"
                                        aria-hidden="true">
                                        <path fill-rule="evenodd"
                                            d="M10 18a8 8 0 100-16 8 8 0 000 16Zm.75-11.5a.75.75 0 10-1.5 0 .75.75 0 001.5 0ZM9 9.75a1 1 0 112 0v4.5a1 1 0 11-2 0v-4.5Z"
                                            clip-rule="evenodd" />
                                    </svg>
                                </div>
                                <div class="ml-3">
                                    <p class="text-sm text-yellow-700">Chỉ áp dụng trong <span class="font-bold">thời
                                            gian</span> này.</p>
                                </div>
                            </div>
                        </div>

                        <!-- Actions -->
                        <div class="flex flex-col space-y-3">

                            <button id="gift24h-later"
                                class="text-gray-500 hover:text-gray-700 text-sm font-medium py-2 px-4 rounded-lg transition">
                                Để sau
                            </button>
                            <div id="gift24h-expired" class="hidden text-center text-red-600 font-semibold">Đã hết hạn
                            </div>

                        </div>
                    </div>
                </div>
            </div>
        </div>
        <script>
            (() => {
                const MODAL = document.getElementById('gift24h-modal');
                const CLOSE = document.getElementById('gift24h-x');
                const CLAIM = document.getElementById('gift24h-claim');
                const LATER = document.getElementById('gift24h-later');
                const HINT = document.getElementById('gift24h-claimedHint');
                const FAB = document.getElementById('gift24h-fab');
                const EXPIRED = document.getElementById('gift24h-expired');

                // New: per-box refs for your UI
                const BOX_D = document.getElementById('gift24h-days');
                const BOX_H = document.getElementById('gift24h-hours');
                const BOX_M = document.getElementById('gift24h-minutes');
                const BOX_S = document.getElementById('gift24h-seconds');

                const KEY_START = 'gift24h_start';
                const KEY_STATE = 'gift24h_state'; // 'modal' | 'fab' | 'claimed' | 'hidden'
                const DURATION_MS = 24 * 60 * 60 * 1000;

                // Helpers
                const show = (el) => el && el.classList.remove('hidden');
                const hide = (el) => el && el.classList.add('hidden');

                function readStart() {
                    const raw = localStorage.getItem(KEY_START);
                    const t = raw ? Number(raw) : NaN;
                    if (Number.isFinite(t)) return t;
                    const now = Date.now();
                    localStorage.setItem(KEY_START, String(now));
                    return now;
                }

                function timeLeft() {
                    const start = readStart();
                    return (start + DURATION_MS) - Date.now();
                }

                function getState() {
                    return localStorage.getItem(KEY_STATE) || 'modal';
                }
                function setState(s) {
                    localStorage.setItem(KEY_STATE, s);
                }

                // Render countdown per-box
                function renderBoxes(ms) {
                    if (ms < 0) ms = 0;
                    const totalSec = Math.floor(ms / 1000);
                    const days = Math.floor(totalSec / 86400);
                    const hours = Math.floor((totalSec % 86400) / 3600);
                    const minutes = Math.floor((totalSec % 3600) / 60);
                    const seconds = totalSec % 60;

                    if (BOX_D) BOX_D.textContent = String(days).padStart(2, '0');
                    if (BOX_H) BOX_H.textContent = String(hours).padStart(2, '0');
                    if (BOX_M) BOX_M.textContent = String(minutes).padStart(2, '0');
                    if (BOX_S) BOX_S.textContent = String(seconds).padStart(2, '0');
                }

                function applyState() {
                    const left = timeLeft();
                    renderBoxes(left);

                    const expired = left <= 0;
                    if (expired) {
                        show(EXPIRED);
                        // khoá nhận quà
                        CLAIM?.setAttribute('disabled', 'true');
                        CLAIM?.classList.add('opacity-50', 'cursor-not-allowed');
                    } else {
                        hide(EXPIRED);
                        CLAIM?.removeAttribute('disabled');
                        CLAIM?.classList.remove('opacity-50', 'cursor-not-allowed');
                    }

                    switch (getState()) {
                        case 'modal':
                            show(MODAL); hide(FAB); break;
                        case 'fab':
                            hide(MODAL); show(FAB); break;
                        case 'claimed':
                            hide(MODAL); show(FAB); show(HINT); break;
                        default:
                            hide(MODAL); show(FAB);
                    }
                }

                // Events
                CLOSE?.addEventListener('click', () => { setState('fab'); applyState(); });
                LATER?.addEventListener('click', () => { setState('fab'); applyState(); });
                CLAIM?.addEventListener('click', () => { setState('claimed'); applyState(); /* TODO: gọi API/đi link ưu đãi ở đây */ });
                FAB?.addEventListener('click', () => { setState('modal'); applyState(); });

                // Tick
                applyState();
                setInterval(applyState, 1000);
            })();
        </script>
        <!-- Popup ẩn sẵn -->
        <div id="popupOverlay" class="fixed inset-0 bg-black/50 flex items-center justify-center hidden z-50">
            <div class="!bg-[#F5F5F5] rounded-xl shadow-xl w-[95vw] h-[95vh] relative">
                <header class="h-16 flex items-center px-6 gap-10 bg-white rounded-t-xl">
                    <h1 class="text-3xl font-bold">Autolook</h1>
                    <div class="flex gap-3">
                        <button class="bg-[#F05454] hover:bg-[#30475E] text-white px-2 rounded-lg w-[40px]"><i
                                class="fas fa-reply"></i></button>
                        <button class="bg-[#F05454] hover:bg-[#30475E] text-white px-2 rounded-lg w-[40px]"><i
                                class="	fas fa-share"></i></button>
                        <button class="bg-[#F05454] hover:bg-[#30475E] text-white px-2 rounded-lg w-[100px]">Đảo
                            ngược</button>
                        <button class="bg-[#F05454] hover:bg-[#30475E] text-white px-2 rounded-lg w-[100px]">Xoá
                            hết</button>
                        <button
                            class="bg-[#F05454] hover:bg-[#30475E] text-white px-2 rounded-lg w-[100px]">Lưu</button>
                    </div>
                    <button id="closePopup"
                        class="absolute top-2 right-2 w-8 h-8 flex items-center justify-center bg-gray-300 hover:bg-red-500 text-black hover:text-white rounded-full">
                        <i class="fas fa-times"></i>
                    </button>
                </header>
                <div class="flex justify-between h-[calc(95vh-64px)]">
                    <div class="bg-white w-[90px] h-full rounded-bl-xl flex flex-col items-center justify-start">
                        <div class="grid gap-4 py-3">
                            <button id="btnPencil" class="h-[55px] w-[55px] rounded-lg" title="Brush"><i
                                    class="fa-solid fa-pencil text-3xl opacity-70"></i></button>
                            <button id="btnEraser" class="h-[55px] w-[55px] rounded-lg" title="Eraser"><i
                                    class="fa-solid fa-eraser text-3xl opacity-70"></i></button>
                        </div>
                    </div>

                    <div class="p-6 w-full">
                        <!-- Viewport -->
                        <div id="viewport"
                            class="relative w-full h-[80vh] overflow-hidden bg-[radial-gradient(circle,_#eee_1px,_transparent_1px)] [background-size:16px_16px] cursor-default select-none">
                            <!-- Stage: CHỈ MỘT -->
                            <div id="stage" class="absolute inset-0 will-change-transform">
                                <img id="zoomableImage" src=""
                                    class="block max-w-none pointer-events-none select-none" />
                                <canvas id="imgLayer" class="absolute inset-0 block max-w-none"></canvas>
                                <canvas id="paintLayer" class="absolute inset-0 block max-w-none"></canvas>
                            </div>

                        </div>


                        <!-- Gợi ý phím tắt nhỏ -->
                        <div class="mt-3 text-sm text-gray-500">
                            <b>Tip:</b> Lăn chuột = Zoom • Giữ <kbd class="px-1 border rounded">Space</kbd> rồi kéo =
                            Pan • Nhấp đúp = Fit to view
                        </div>
                    </div>
                    <div class="bg-white w-[300px] h-full rounded-br-xl px-3">
                        <div class="flex flex-col justify-center gap-7">
                            <h1 class="text-lg mt-2 text-center">Điều chỉnh con trỏ</h1>
                            <button class="bg-gray-400 rounded-lg">Con trỏ mặc định</button>
                            <div>
                                <h1 class="text-sm">Hình dạng con trỏ</h1>
                                <div class="flex gap-3 p-2 bg-gray-200 rounded-lg">
                                    <button class="w-[35px] h-[35px] rounded-full bg-gray-400">

                                    </button>
                                    <button class="w-[35px] h-[35px] bg-gray-400"></button>
                                </div>
                            </div>
                            <div>
                                <div class="grid">
                                    <span class="text-sm">Kích thước con trỏ</span>
                                    <input type="range" id="length" min="1" max="100" step="1" value="23">
                                </div>
                                <div class="grid">
                                    <span class="text-sm">Độ trong suốt</span>
                                    <input type="range" id="length" min="0" max="1" step="0.01" value="0.7">
                                </div>
                                <div class="grid">
                                    <span class="text-sm">Độ cứng</span>
                                    <input type="range" id="length" min="0" max="1" step="0.01" value="1">
                                </div>
                                <div class="grid">
                                    <span class="text-sm">Làm mịn độ chính xác</span>
                                    <input type="range" id="length" min="1" max="100" step="1" value="10">
                                </div>
                            </div>
                            <div class="">
                                <h1>Màu con trỏ</h1>
                                <select id="brushColorSelect" class="p-2 bg-gray-200 rounded-lg">
                                    <option value="black" selected>black</option>
                                    <option value="white">white</option>
                                </select>

                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <script>
            document.addEventListener("DOMContentLoaded", function () {
                const openBtn = document.querySelector("#submitBtn"); // nút "Tô vùng chọn"
                const popup = document.querySelector("#popupOverlay");
                const closeBtn = document.querySelector("#closePopup");

                openBtn.addEventListener("click", function (e) {
                    e.preventDefault();
                    popup.classList.remove("hidden"); // hiện popup
                });

                closeBtn.addEventListener("click", function () {
                    popup.classList.add("hidden"); // ẩn popup
                });

                // Click ra ngoài để đóng
                popup.addEventListener("click", function (e) {
                    if (e.target === popup) {
                        popup.classList.add("hidden");
                    }
                });
            });
        </script>
        <script>
            document.addEventListener("DOMContentLoaded", () => {
                const viewport = document.getElementById("viewport");
                const stage = document.getElementById("stage");
                const img = document.getElementById("zoomableImage");

                let scale = 1, minScale = 0.1, maxScale = 8;
                let originX = 0, originY = 0;        // pan offset (px)
                let isDragging = false;
                let dragStartX = 0, dragStartY = 0;  // pointer start (px)
                let panStartX = 0, panStartY = 0;    // origin at start (px)
                let spaceDown = false;

                // Ngăn Space làm trang cuộn
                window.addEventListener("keydown", (e) => {
                    if (e.code === "Space") {
                        if (!spaceDown) e.preventDefault();
                        spaceDown = true;
                        if (!isDragging) viewport.style.cursor = "grab";
                    }
                }, { passive: false });

                window.addEventListener("keyup", (e) => {
                    if (e.code === "Space") {
                        spaceDown = false;
                        if (!isDragging) viewport.style.cursor = "default";
                    }
                });

                // Fit ảnh vào viewport khi tải xong
                img.addEventListener("load", fitToView);
                if (img.complete) fitToView(); // phòng khi ảnh đã cache

                // 1) Đặt cờ popup (nếu bạn có open/close popup)
                function openPaintPopup() {
                    // ... logic mở popup ...
                    // chờ 1 frame để layout đo được kích thước thật
                    requestAnimationFrame(() => setTimeout(fitToView, 0));
                }

                // 2) Fit ngay khi ảnh sẵn sàng
                img.addEventListener("load", fitToView);
                if (img.complete) setTimeout(fitToView, 0);

                // 3) Fit khi đổi kích thước khung
                window.addEventListener("resize", () => {
                    // chỉ fit khi người dùng chưa tự zoom/pan quá xa (tuỳ chọn)
                    fitToView();
                });

                function fitToView() {
                    const vw = viewport.clientWidth;
                    const vh = viewport.clientHeight;
                    if (!vw || !vh) return; // tránh tính sai khi viewport đang 0

                    const iw = img.naturalWidth || img.width;
                    const ih = img.naturalHeight || img.height;

                    // scale "contain"
                    const s = Math.min(vw / iw, vh / ih);
                    scale = clamp(s, minScale, maxScale);

                    // CĂN GIỮA CHUẨN
                    originX = (vw - iw * scale) / 2;
                    originY = (vh - ih * scale) / 2;

                    applyTransform();
                }


                // Wheel zoom – giữ tâm zoom tại vị trí con trỏ
                viewport.addEventListener("wheel", (e) => {
                    e.preventDefault();
                    const rect = viewport.getBoundingClientRect();
                    const mouseX = e.clientX - rect.left; // toạ độ chuột trong viewport
                    const mouseY = e.clientY - rect.top;

                    const prevScale = scale;
                    const zoomDir = e.deltaY > 0 ? -1 : 1;
                    const zoomFactor = 1 + 0.12 * zoomDir; // tốc độ zoom
                    scale = clamp(scale * zoomFactor, minScale, maxScale);

                    // Giữ điểm (mouseX, mouseY) nằm yên sau khi scale
                    const imgX_before = (mouseX - originX) / prevScale;
                    const imgY_before = (mouseY - originY) / prevScale;
                    originX = mouseX - imgX_before * scale;
                    originY = mouseY - imgY_before * scale;

                    applyTransform();
                }, { passive: false });

                // Pointer Events để kéo cả vùng trống
                viewport.addEventListener("pointerdown", (e) => {
                    // Cho phép kéo nếu: đang giữ Space, hoặc dùng nút giữa (button === 1)
                    if (!spaceDown && e.button !== 1) return;
                    e.preventDefault();

                    isDragging = true;
                    viewport.setPointerCapture(e.pointerId);

                    dragStartX = e.clientX;
                    dragStartY = e.clientY;
                    panStartX = originX;
                    panStartY = originY;

                    viewport.style.cursor = "grabbing";
                });

                viewport.addEventListener("pointermove", (e) => {
                    if (!isDragging) return;
                    const dx = e.clientX - dragStartX;
                    const dy = e.clientY - dragStartY;

                    originX = panStartX + dx;
                    originY = panStartY + dy;

                    applyTransform();
                });

                function endDrag(e) {
                    if (!isDragging) return;
                    isDragging = false;
                    try { viewport.releasePointerCapture(e.pointerId); } catch { }
                    viewport.style.cursor = spaceDown ? "grab" : "default";
                }
                viewport.addEventListener("pointerup", endDrag);
                viewport.addEventListener("pointercancel", endDrag);
                viewport.addEventListener("pointerleave", endDrag);

                // Double click = Fit to view
                viewport.addEventListener("dblclick", (e) => {
                    e.preventDefault();
                    fitToView();
                });

                // Áp transform
                function applyTransform() {
                    stage.style.transform = `translate(${originX}px, ${originY}px) scale(${scale})`;
                    stage.style.transformOrigin = "0 0";
                }

                function clamp(v, min, max) { return Math.max(min, Math.min(max, v)); }
            });
        </script>
        <script>
            document.addEventListener("DOMContentLoaded", () => {
                const viewport = document.getElementById("viewport");
                const img = document.getElementById("zoomableImage");
                const canvas = document.getElementById("paintLayer");
                const ctx = canvas.getContext("2d");

                const btnPencil = document.getElementById("btnPencil");
                const btnEraser = document.getElementById("btnEraser");

                // ---- brush settings (có thể nối với UI slider sau) ----
                let tool = "brush";                 // "brush" | "eraser"
                let brushSize = 14;                 // px
                let brushOpacity = 1.0;             // 0..1
                let brushColor = "#000000";         // mặc định đen
                let isDrawing = false;

                // Fit canvas theo kích thước ảnh gốc
                function sizeCanvasToImage() {
                    const iw = img.naturalWidth || img.width;
                    const ih = img.naturalHeight || img.height;
                    if (!iw || !ih) return;
                    // Canvas vẽ theo pixel thật của ảnh
                    canvas.width = iw;
                    canvas.height = ih;
                }

                // Gọi khi ảnh load & khi fitToView()
                img.addEventListener("load", sizeCanvasToImage);
                if (img.complete) sizeCanvasToImage();

                // Đổi tool
                btnPencil.addEventListener("click", () => {
                    tool = "brush";
                    btnPencil.classList.add("sidebar-active");
                    btnEraser.classList.remove("sidebar-active");
                });
                btnEraser.addEventListener("click", () => {
                    tool = "eraser";
                    btnEraser.classList.add("sidebar-active");
                    btnPencil.classList.remove("sidebar-active");
                });

                // Tính toạ độ vẽ trong hệ toạ độ ảnh (stage space)
                function pointerToImageCoord(e) {
                    const rect = viewport.getBoundingClientRect();
                    const px = e.clientX - rect.left; // toạ độ trong viewport
                    const py = e.clientY - rect.top;
                    // chuyển về stage/ảnh: trừ pan rồi chia scale
                    const x = (px - window.originX) / window.scale;
                    const y = (py - window.originY) / window.scale;
                    return { x, y };
                }

                // Bắt đầu vẽ
                viewport.addEventListener("pointerdown", (e) => {
                    // Không vẽ khi đang pan bằng Space hoặc khi bấm nút giữa/ phải
                    if (window.spaceDown || e.button !== 0) return;

                    isDrawing = true;
                    viewport.setPointerCapture(e.pointerId);

                    const p = pointerToImageCoord(e);
                    ctx.lineCap = "round";
                    ctx.lineJoin = "round";
                    ctx.lineWidth = brushSize;

                    if (tool === "brush") {
                        ctx.globalCompositeOperation = "source-over";
                        ctx.strokeStyle = hexWithAlpha(brushColor, brushOpacity);
                    } else {
                        // Eraser: xoá nét vẽ
                        ctx.globalCompositeOperation = "destination-out";
                        ctx.strokeStyle = "rgba(0,0,0,1)";
                    }

                    ctx.beginPath();
                    ctx.moveTo(p.x, p.y);
                });

                viewport.addEventListener("pointermove", (e) => {
                    if (!isDrawing) return;
                    const p = pointerToImageCoord(e);
                    ctx.lineTo(p.x, p.y);
                    ctx.stroke();
                });

                function endDraw(e) {
                    if (!isDrawing) return;
                    isDrawing = false;
                    try { viewport.releasePointerCapture(e.pointerId); } catch { }
                    ctx.closePath();
                }
                viewport.addEventListener("pointerup", endDraw);
                viewport.addEventListener("pointerleave", endDraw);
                viewport.addEventListener("pointercancel", endDraw);

                // Helper thêm alpha cho màu hex
                function hexWithAlpha(hex, alpha) {
                    // hex "#RRGGBB"
                    const r = parseInt(hex.slice(1, 3), 16);
                    const g = parseInt(hex.slice(3, 5), 16);
                    const b = parseInt(hex.slice(5, 7), 16);
                    return `rgba(${r},${g},${b},${alpha})`;
                }

                // Nếu bạn có hàm fitToView() đã viết trước đó, hãy gọi lại sizeCanvasToImage() ngay sau khi fit
                // ví dụ:
                // const oldFit = window.fitToView;
                // window.fitToView = function() { oldFit(); sizeCanvasToImage(); };
            });
        </script>

        <script>
            (() => {
                const btn = document.getElementById('modeBtn');
                const menu = document.getElementById('modeMenu');
                const label = document.getElementById('modeLabel');

                // Toggle mở/đóng
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    menu.classList.toggle('hidden');
                });

                // Đóng khi click ra ngoài hoặc nhấn Esc
                document.addEventListener('click', () => menu.classList.add('hidden'));
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape') menu.classList.add('hidden');
                });

                // Chọn mục -> đổi label + điều hướng
                menu.querySelectorAll('[data-target]').forEach(item => {
                    item.addEventListener('click', () => {
                        const href = item.getAttribute('data-target');
                        label.textContent = item.textContent.trim();
                        window.location.href = href;
                    });
                });

                // Khởi tạo label theo trang hiện tại
                const path = location.pathname;
                if (path.includes('ghep-anhv2.html')) label.textContent = 'Thủ công';
                else if (path.includes('ghep-anh.html')) label.textContent = 'Tự động';
            })();
        </script>
        <script>
            document.addEventListener("DOMContentLoaded", () => {
                // ===== DOM =====
                const popup = document.getElementById("popupOverlay");
                const viewport = popup.querySelector("#viewport");
                const stage = popup.querySelector("#stage");
                const imgTag = stage.querySelector("#zoomableImage");
                const imgLayer = stage.querySelector("#imgLayer");   // nền ảnh
                const paint = stage.querySelector("#paintLayer"); // lớp tô
                const ictx = imgLayer.getContext("2d");
                const pctx = paint.getContext("2d");

                // ===== TOOLBAR BUTTONS =====
                const toolbar = popup.querySelector('header .flex.gap-3');
                const btnUndo = toolbar?.querySelector('i.fa-reply')?.closest('button') || null;
                const btnRedo = toolbar?.querySelector('i.fa-share')?.closest('button') || null;
                const btnByText = (label) => {
                    if (!toolbar) return null;
                    return Array.from(toolbar.querySelectorAll('button'))
                        .find(b => (b.textContent || "").trim().includes(label)) || null;
                };
                const btnInvert = btnByText('Đảo');
                const btnClear = btnByText('Xoá');
                const btnSave = btnByText('Lưu');

                // ===== Input ảnh (ô "Ảnh người mẫu" – phần đầu tiên) =====
                const firstModelInput = document.querySelectorAll("#imageInput")[0];

                // ===== Panel =====
                const [sizeSlider, opacitySlider, hardnessSlider, smoothSlider] =
                    popup.querySelectorAll('input[type="range"]');
                const colorSelect = document.getElementById("brushColorSelect");
                const btnBrush = document.getElementById("btnPencil");
                const btnEraser = document.getElementById("btnEraser");

                // ===== UNDO/REDO HISTORY (ảnh chụp paintLayer) =====
                const MAX_HISTORY = 80;
                let undoStack = [];
                let redoStack = [];
                let historyInitialized = false;

                function drawStateFromURL(url) {
                    const im = new Image();
                    im.onload = () => {
                        pctx.clearRect(0, 0, paint.width, paint.height);
                        pctx.globalCompositeOperation = 'source-over';
                        pctx.globalAlpha = 1;
                        pctx.drawImage(im, 0, 0, paint.width, paint.height);
                    };
                    im.src = url;
                }
                function pushHistory() {
                    try {
                        const url = paint.toDataURL('image/png');
                        undoStack.push(url);
                        if (undoStack.length > MAX_HISTORY) undoStack.shift();
                        redoStack.length = 0; // reset redo
                    } catch (e) { }
                }
                function ensureHistoryInit() {
                    if (historyInitialized) return;
                    pushHistory(); // trạng thái rỗng ban đầu
                    historyInitialized = true;
                }

                // ===== STATE =====
                let mode = "paint", drawing = false;
                let brushSize = +sizeSlider?.value || 24;
                let brushOpacity = +opacitySlider?.value ?? 1;
                let hardness = +hardnessSlider?.value ?? 1;   // (không dùng khi tô đặc)
                let smoothSteps = +smoothSlider?.value || 10;
                // mặc định màu đen
                if (colorSelect) colorSelect.value = "black";
                let brushColor = (colorSelect?.value || "black").toLowerCase();

                // ===== Handlers panel =====
                sizeSlider?.addEventListener("input", e => brushSize = +e.target.value);
                opacitySlider?.addEventListener("input", e => brushOpacity = +e.target.value);
                hardnessSlider?.addEventListener("input", e => hardness = +e.target.value);
                smoothSlider?.addEventListener("input", e => smoothSteps = +e.target.value);

                colorSelect?.addEventListener("change", e => {
                    brushColor = (e.target.value || "black").toLowerCase();
                    // Trắng phải là nét đặc tuyệt đối
                    if (brushColor === "white") {
                        brushOpacity = 1; if (opacitySlider) opacitySlider.value = "1";
                        hardness = 1; if (hardnessSlider) hardnessSlider.value = "1";
                    }
                });

                btnBrush?.addEventListener("click", () => { mode = "paint"; paint.style.cursor = "crosshair"; });
                btnEraser?.addEventListener("click", () => { mode = "erase"; paint.style.cursor = "crosshair"; });

                // ===== Upload ảnh (không tự mở popup) =====
                firstModelInput?.addEventListener("change", e => {
                    const f = e.target.files?.[0]; if (!f) return;
                    imgTag.src = URL.createObjectURL(f);
                });

                // ===== Đồng bộ & vẽ nền ảnh vào imgLayer (KHÔNG đụng paintLayer) =====
                function syncAndDraw() {
                    const rImg = imgTag.getBoundingClientRect();
                    const rView = viewport.getBoundingClientRect();

                    for (const c of [imgLayer, paint]) {
                        Object.assign(c.style, {
                            position: "absolute",
                            left: (rImg.left - rView.left) + "px",
                            top: (rImg.top - rView.top) + "px",
                            width: rImg.width + "px",
                            height: rImg.height + "px",
                            pointerEvents: "auto",
                            zIndex: c === imgLayer ? 20 : 30
                        });
                        c.width = Math.max(1, Math.round(rImg.width));
                        c.height = Math.max(1, Math.round(rImg.height));
                    }

                    // Vẽ ảnh gốc lên nền
                    ictx.clearRect(0, 0, imgLayer.width, imgLayer.height);
                    if (imgTag.naturalWidth)
                        ictx.drawImage(imgTag, 0, 0, imgLayer.width, imgLayer.height);

                    ensureHistoryInit(); // init history sau sync
                    imgTag.style.visibility = "hidden";
                }

                imgTag.addEventListener("load", () => {
                    if (!popup.classList.contains("hidden")) requestAnimationFrame(syncAndDraw);
                });
                window.addEventListener("resize", () => {
                    if (!popup.classList.contains("hidden")) requestAnimationFrame(syncAndDraw);
                });
                new MutationObserver(() => {
                    if (!popup.classList.contains("hidden")) requestAnimationFrame(syncAndDraw);
                }).observe(popup, { attributes: true, attributeFilter: ["class"] });

                // ===== VẼ (stroke liền mạch, không donut) =====
                paint.addEventListener("contextmenu", e => e.preventDefault()); // chặn chuột phải

                function getPos(evt) {
                    const r = paint.getBoundingClientRect();
                    const cx = evt.touches ? evt.touches[0].clientX : evt.clientX;
                    const cy = evt.touches ? evt.touches[0].clientY : evt.clientY;
                    return {
                        x: (cx - r.left) * (paint.width / r.width),
                        y: (cy - r.top) * (paint.height / r.height)
                    };
                }

                function begin(e) {
                    if (e.button !== undefined && e.button !== 0) return; // chỉ chuột trái
                    if (paint.width < 2) return;

                    const p = getPos(e);
                    drawing = true;

                    pctx.save();
                    pctx.globalCompositeOperation = (mode === "erase") ? "destination-out" : "source-over";
                    pctx.globalAlpha = (mode === "erase") ? 1 : brushOpacity;
                    pctx.lineCap = "round";
                    pctx.lineJoin = "round";
                    pctx.lineWidth = brushSize;
                    if (mode !== "erase") pctx.strokeStyle = (brushColor === "white") ? "#fff" : "#000";
                    pctx.beginPath();
                    pctx.moveTo(p.x, p.y);

                    window.addEventListener("mousemove", move, { passive: false });
                    window.addEventListener("mouseup", end);
                    e.preventDefault();
                }

                function move(e) {
                    if (!drawing) return;
                    const p = getPos(e);
                    pctx.lineTo(p.x, p.y);
                    pctx.stroke();
                    e.preventDefault();
                }

                function end() {
                    if (!drawing) return;
                    drawing = false;
                    pctx.closePath();
                    pctx.restore();
                    window.removeEventListener("mousemove", move);
                    window.removeEventListener("mouseup", end);
                    // chụp lịch sử sau mỗi stroke
                    pushHistory();
                }

                paint.addEventListener("mousedown", begin);
                paint.addEventListener("touchstart", begin, { passive: false });
                paint.addEventListener("touchmove", move, { passive: false });
                window.addEventListener("touchend", end);

                // ====== BUTTON HANDLERS ======
                btnUndo?.addEventListener('click', () => {
                    if (undoStack.length <= 1) return;
                    const curr = undoStack.pop();
                    redoStack.push(curr);
                    const prev = undoStack[undoStack.length - 1];
                    drawStateFromURL(prev);
                });

                btnRedo?.addEventListener('click', () => {
                    const next = redoStack.pop();
                    if (!next) return;
                    undoStack.push(next);
                    drawStateFromURL(next);
                });

                // Âm bản trên lớp tô (trắng <-> đen)
                btnInvert?.addEventListener('click', () => {
                    pctx.save();
                    pctx.globalCompositeOperation = 'difference';
                    pctx.fillStyle = '#fff';
                    pctx.fillRect(0, 0, paint.width, paint.height);
                    pctx.restore();
                    pushHistory();
                });

                // Xoá hết lớp tô
                btnClear?.addEventListener('click', () => {
                    pctx.clearRect(0, 0, paint.width, paint.height);
                    pushHistory();
                });

                // Lưu: ghép imgLayer + paintLayer → cập nhật preview ngoài + cập nhật luôn ảnh trong popup, rồi ĐÓNG popup
                btnSave?.addEventListener('click', () => {
                    const out = document.createElement('canvas');
                    out.width = imgLayer.width;
                    out.height = imgLayer.height;
                    const octx = out.getContext('2d');

                    octx.drawImage(imgLayer, 0, 0);
                    octx.drawImage(paint, 0, 0);

                    const dataURL = out.toDataURL('image/png');

                    // fill vào khung upload ngoài (cột trái – phần đầu tiên)
                    const firstPreview = document.querySelectorAll('#previewImage')[0];
                    if (firstPreview) {
                        firstPreview.src = dataURL;
                        firstPreview.style.display = 'block';
                        const placeholder = firstPreview.parentElement.querySelector('#placeholderContent');
                        if (placeholder) placeholder.style.display = 'none';
                    }

                    // cập nhật luôn ảnh trong popup cho lần mở kế tiếp
                    imgTag.src = dataURL;
                    // reset lớp tô & history cho phiên mới
                    pctx.clearRect(0, 0, paint.width, paint.height);
                    undoStack = []; redoStack = []; historyInitialized = false; ensureHistoryInit();

                    // TỰ THOÁT POPUP
                    popup.classList.add('hidden');
                });

                // Nếu popup đang mở sẵn thì sync ngay
                if (!popup.classList.contains("hidden")) requestAnimationFrame(syncAndDraw);
            });
        </script>

</body>

</html>